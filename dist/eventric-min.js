!function(){"use strict";var n="undefined"==typeof window?global:window;if("function"!=typeof n.require){var t={},e={_load:function(n,r){var o=e._resolveFilename(n,r),s=t[o];if(!s)throw new Error('Cannot find module "'+o+'" from "'+r+'"');if(e._cache[o])return e._cache[o].exports;var u=i(o),a={id:o,exports:{}};return e._cache[o]=a,s.call(a.exports,a.exports,u,a),a.exports},_cache:{},_resolveFilename:function(n,e){var r=o(s(e),n);return t.hasOwnProperty(r)?r:(r=o(r,"./index"),t.hasOwnProperty(r)?r:n)}},r=function(n,t){return e._load(n,t)},o=function(){var n=/^\.\.?(\/|$)/;return function(t,e){var r,o,i=[];r=(n.test(e)?t+"/"+e:e).split("/");for(var s=0,u=r.length;u>s;s++)o=r[s],".."===o?i.pop():"."!==o&&""!==o&&i.push(o);return i.join("/")}}(),i=function(t){return function(e){return n.require(e,t)}},s=function(n){return n?n.split("/").slice(0,-1).join("/"):""};r.register=r.define=function(n,e){if("object"==typeof n)for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);else t[n]=e},r.list=function(){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e);return n},n.require=r,r.define("module",function(n,t,r){r.exports=e})}}(),require.register("eventric/index",function(n,t,e){e.exports=t("./src")}),require.register("es6-promise",function(){!function(){var n,t,e,r;!function(){var o={},i={};n=function(n,t,e){o[n]={deps:t,callback:e}},r=e=t=function(n){function e(t){if("."!==t.charAt(0))return t;for(var e=t.split("/"),r=n.split("/").slice(0,-1),o=0,i=e.length;i>o;o++){var s=e[o];if(".."===s)r.pop();else{if("."===s)continue;r.push(s)}}return r.join("/")}if(r._eak_seen=o,i[n])return i[n];if(i[n]={},!o[n])throw new Error("Could not find module "+n);for(var s,u=o[n],a=u.deps,c=u.callback,l=[],p=0,f=a.length;f>p;p++)l.push("exports"===a[p]?s={}:t(e(a[p])));var m=c.apply(this,l);return i[n]=s||m}}(),n("promise/all",["./utils","exports"],function(n,t){"use strict";function e(n){var t=this;if(!r(n))throw new TypeError("You must pass an array to all.");return new t(function(t,e){function r(n){return function(t){i(n,t)}}function i(n,e){u[n]=e,0===--a&&t(u)}var s,u=[],a=n.length;0===a&&t([]);for(var c=0;c<n.length;c++)s=n[c],s&&o(s.then)?s.then(r(c),e):i(c,s)})}var r=n.isArray,o=n.isFunction;t.all=e}),n("promise/asap",["exports"],function(n){"use strict";function t(){return function(){process.nextTick(o)}}function e(){var n=0,t=new a(o),e=document.createTextNode("");return t.observe(e,{characterData:!0}),function(){e.data=n=++n%2}}function r(){return function(){c.setTimeout(o,1)}}function o(){for(var n=0;n<l.length;n++){var t=l[n],e=t[0],r=t[1];e(r)}l=[]}function i(n,t){var e=l.push([n,t]);1===e&&s()}var s,u="undefined"!=typeof window?window:{},a=u.MutationObserver||u.WebKitMutationObserver,c="undefined"!=typeof global?global:void 0===this?window:this,l=[];s="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?t():a?e():r(),n.asap=i}),n("promise/config",["exports"],function(n){"use strict";function t(n,t){return 2!==arguments.length?e[n]:void(e[n]=t)}var e={instrument:!1};n.config=e,n.configure=t}),n("promise/polyfill",["./promise","./utils","exports"],function(n,t,e){"use strict";function r(){var n;n="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var t="Promise"in n&&"resolve"in n.Promise&&"reject"in n.Promise&&"all"in n.Promise&&"race"in n.Promise&&function(){var t;return new n.Promise(function(n){t=n}),i(t)}();t||(n.Promise=o)}var o=n.Promise,i=t.isFunction;e.polyfill=r}),n("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(n,t,e,r,o,i,s,u){"use strict";function a(n){if(!E(n))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof a))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],c(n,this)}function c(n,t){function e(n){g(t,n)}function r(n){d(t,n)}try{n(e,r)}catch(o){r(o)}}function l(n,t,e,r){var o,i,s,u,a=E(e);if(a)try{o=e(r),s=!0}catch(c){u=!0,i=c}else o=r,s=!0;m(t,o)||(a&&s?g(t,o):u?d(t,i):n===I?g(t,o):n===C&&d(t,o))}function p(n,t,e,r){var o=n._subscribers,i=o.length;o[i]=t,o[i+I]=e,o[i+C]=r}function f(n,t){for(var e,r,o=n._subscribers,i=n._detail,s=0;s<o.length;s+=3)e=o[s],r=o[s+t],l(t,e,r,i);n._subscribers=null}function m(n,t){var e,r=null;try{if(n===t)throw new TypeError("A promises callback cannot return that same promise.");if(b(t)&&(r=t.then,E(r)))return r.call(t,function(r){return e?!0:(e=!0,void(t!==r?g(n,r):h(n,r)))},function(t){return e?!0:(e=!0,void d(n,t))}),!0}catch(o){return e?!0:(d(n,o),!0)}return!1}function g(n,t){n===t?h(n,t):m(n,t)||h(n,t)}function h(n,t){n._state===A&&(n._state=S,n._detail=t,y.async(v,n))}function d(n,t){n._state===A&&(n._state=S,n._detail=t,y.async(_,n))}function v(n){f(n,n._state=I)}function _(n){f(n,n._state=C)}var y=n.config,b=(n.configure,t.objectOrFunction),E=t.isFunction,D=(t.now,e.all),w=r.race,P=o.resolve,j=i.reject,x=s.asap;y.async=x;var A=void 0,S=0,I=1,C=2;a.prototype={constructor:a,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(n,t){var e=this,r=new this.constructor(function(){});if(this._state){var o=arguments;y.async(function(){l(e._state,r,o[e._state-1],e._detail)})}else p(this,r,n,t);return r},"catch":function(n){return this.then(null,n)}},a.all=D,a.race=w,a.resolve=P,a.reject=j,u.Promise=a}),n("promise/race",["./utils","exports"],function(n,t){"use strict";function e(n){var t=this;if(!r(n))throw new TypeError("You must pass an array to race.");return new t(function(t,e){for(var r,o=0;o<n.length;o++)r=n[o],r&&"function"==typeof r.then?r.then(t,e):t(r)})}var r=n.isArray;t.race=e}),n("promise/reject",["exports"],function(n){"use strict";function t(n){var t=this;return new t(function(t,e){e(n)})}n.reject=t}),n("promise/resolve",["exports"],function(n){"use strict";function t(n){if(n&&"object"==typeof n&&n.constructor===this)return n;var t=this;return new t(function(t){t(n)})}n.resolve=t}),n("promise/utils",["exports"],function(n){"use strict";function t(n){return e(n)||"object"==typeof n&&null!==n}function e(n){return"function"==typeof n}function r(n){return"[object Array]"===Object.prototype.toString.call(n)}var o=Date.now||function(){return(new Date).getTime()};n.objectOrFunction=t,n.isFunction=e,n.isArray=r,n.now=o}),t("promise/polyfill").polyfill()}()}),require.register("eventric/src/aggregate",function(n,t,e){var r,o,i,s=function(n,t){return function(){return n.apply(t,arguments)}},u=[].slice;i=t("eventric"),o=t("./domain_event"),r=function(){function n(n,t,e){this._context=n,this._name=t,this.create=s(this.create,this),this.getDomainEvents=s(this.getDomainEvents,this),this.emitDomainEvent=s(this.emitDomainEvent,this),this._domainEvents=[],this.root=e?new e:{},this.root.$emitDomainEvent=this.emitDomainEvent}return n.prototype.emitDomainEvent=function(n,t){var e,r,o;if(e=this._context.getDomainEvent(n),!e)throw o="Tried to emitDomainEvent '"+n+"' which is not defined",i.log.error(o),new Error(o);return r=this._createDomainEvent(n,e,t),this._domainEvents.push(r),this._handleDomainEvent(n,r),i.log.debug("Created and Handled DomainEvent in Aggregate",r)},n.prototype._createDomainEvent=function(n,t,e){return new o({id:i.generateUid(),name:n,aggregate:{id:this.id,name:this._name},context:this._context.name,payload:new t(e)})},n.prototype._handleDomainEvent=function(n,t){return this.root["handle"+n]?this.root["handle"+n](t,function(){}):i.log.debug("Tried to handle the DomainEvent '"+n+"' without a matching handle method")},n.prototype.getDomainEvents=function(){return this._domainEvents},n.prototype.applyDomainEvents=function(n){var t,e,r,o;for(o=[],e=0,r=n.length;r>e;e++)t=n[e],o.push(this._applyDomainEvent(t));return o},n.prototype._applyDomainEvent=function(n){return this._handleDomainEvent(n.name,n)},n.prototype.create=function(){var n;return n=arguments,new Promise(function(t){return function(e,r){var o,s,a,c;if(t.id=i.generateUid(),"function"!=typeof t.root.create)throw a="No create function on aggregate",i.log.error(a),new Error(a);try{if(o=(c=t.root).create.apply(c,u.call(n).concat([function(n){return n?r(n):e(t)}])),o instanceof Promise)return o.then(function(){return e(t)}),o["catch"](function(n){return r(n)})}catch(l){return s=l,r(s)}}}(this))},n}(),e.exports=r}),require.register("eventric/src/context",function(n,t,e){var r,o,i,s,u,a,c,l=function(n,t){return function(){return n.apply(t,arguments)}},p={}.hasOwnProperty,f=function(n,t){function e(){this.constructor=n}for(var r in t)p.call(t,r)&&(n[r]=t[r]);return e.prototype=t.prototype,n.prototype=new e,n.__super__=t.prototype,n},m=[].slice;a=t("eventric"),u=t("./repository"),i=t("./event_bus"),o=t("./domain_event"),s=t("./pub_sub"),c=t("./projection"),r=function(n){function t(n){this.name=n,this.clearProjectionStore=l(this.clearProjectionStore,this),this.getProjectionStore=l(this.getProjectionStore,this),this.emitDomainEvent=l(this.emitDomainEvent,this),t.__super__.constructor.apply(this,arguments),this._initialized=!1,this._params=a.get(),this._di={},this._aggregateRootClasses={},this._adapterClasses={},this._adapterInstances={},this._commandHandlers={},this._queryHandlers={},this._domainEventClasses={},this._domainEventHandlers={},this._projectionClasses=[],this._repositoryInstances={},this._domainServices={},this._storeClasses={},this._storeInstances={},this._eventBus=new i}return f(t,n),t.prototype.log=a.log,t.prototype.set=function(n,t){return this._params[n]=t,this},t.prototype.get=function(n){return this._params[n]},t.prototype.emitDomainEvent=function(n,t){var e,r;if(e=this.getDomainEvent(n),!e)throw new Error("Tried to emitDomainEvent '"+n+"' which is not defined");return r=this._createDomainEvent(n,e,t),this.getDomainEventsStore().saveDomainEvent(r,function(n){return function(){return n._eventBus.publishDomainEvent(r,function(){})}}(this))},t.prototype._createDomainEvent=function(n,t,e){return new o({id:a.generateUid(),name:n,context:this.name,payload:new t(e)})},t.prototype.addStore=function(n,t,e){return null==e&&(e={}),this._storeClasses[n]={Class:t,options:e},this},t.prototype.defineDomainEvent=function(n,t){return this._domainEventClasses[n]=t,this},t.prototype.defineDomainEvents=function(n){var t,e;for(e in n)t=n[e],this.defineDomainEvent(e,t);return this},t.prototype.addCommandHandler=function(n,t){return this._commandHandlers[n]=function(e){return function(){var r,o,i,s,c,l,p;r={id:a.generateUid(),name:n,params:null!=(l=arguments[0])?l:null},c={},p=e._di;for(i in p)o=p[i],c[i]=o;return s=null,c.$repository=function(n){var t,o;return s||(t=e._aggregateRootClasses[n],o=new u({aggregateName:n,AggregateRoot:t,context:e}),s=o),s.setCommand(r),s},t.apply(c,arguments)}}(this),this},t.prototype.addCommandHandlers=function(n){var t,e;for(e in n)t=n[e],this.addCommandHandler(e,t);return this},t.prototype.addQueryHandler=function(n,t){return this._queryHandlers[n]=function(n){return function(){return t.apply(n._di,arguments)}}(this),this},t.prototype.addQueryHandlers=function(n){var t,e;for(e in n)t=n[e],this.addQueryHandler(e,t);return this},t.prototype.addAggregate=function(n,t){return this._aggregateRootClasses[n]=t,this},t.prototype.addAggregates=function(n){var t,e;for(e in n)t=n[e],this.addAggregate(e,t);return this},t.prototype.subscribeToDomainEvent=function(n,t,e){var r;return null==e&&(e={}),r=function(n){return function(){return t.apply(n._di,arguments)}}(this),this._eventBus.subscribeToDomainEvent(n,r,e),this},t.prototype.subscribeToDomainEventWithAggregateId=function(n,t,e,r){var o;return null==r&&(r={}),o=function(n){return function(){return e.apply(n._di,arguments)}}(this),this._eventBus.subscribeToDomainEventWithAggregateId(n,t,o,r)},t.prototype.subscribeToAllDomainEvents=function(n,t){var e;return null==t&&(t={}),e=function(t){return function(){return n.apply(t._di,arguments)}}(this),this._eventBus.subscribeToAllDomainEvents(e,t)},t.prototype.subscribeToDomainEvents=function(n){var t,e;for(t in n)e=n[t],this.subscribeToDomainEvent(t,e);return this},t.prototype.addDomainService=function(n,t){return this._domainServices[n]=function(n){return function(){return t.apply(n._di,arguments)}}(this),this},t.prototype.addDomainServices=function(n){var t,e;for(e in n)t=n[e],this.addDomainService(e,t);return this},t.prototype.addAdapter=function(n,t){return this._adapterClasses[n]=t,this},t.prototype.addAdapters=function(n){var t,e;for(t in n)e=n[t],this.addAdapter(t,e);return this},t.prototype.addProjection=function(n,t){return this._projectionClasses.push({name:n,"class":t}),this},t.prototype.addProjections=function(n){var t,e;for(e in n)t=n[e],this.addProjection(e,t);return this},t.prototype.initialize=function(n){return null==n&&(n=function(){}),new Promise(function(t){return function(e,r){return t.log.debug("["+t.name+"] Initializing"),t.log.debug("["+t.name+"] Initializing Store"),t._initializeStores().then(function(){return t.log.debug("["+t.name+"] Finished initializing Store"),t._di={$adapter:function(){return t.getAdapter.apply(t,arguments)},$query:function(){return t.query.apply(t,arguments)},$domainService:function(){return t.getDomainService(arguments[0]).apply(t,[arguments[1],arguments[2]])},$projectionStore:function(){return t.getProjectionStore.apply(t,arguments)},$emitDomainEvent:function(){return t.emitDomainEvent.apply(t,arguments)}},t.log.debug("["+t.name+"] Initializing Adapters"),t._initializeAdapters()}).then(function(){return t.log.debug("["+t.name+"] Finished initializing Adapters"),t.log.debug("["+t.name+"] Initializing Projections"),t._initializeProjections()}).then(function(){return t.log.debug("["+t.name+"] Finished initializing Projections"),t.log.debug("["+t.name+"] Finished initializing"),t._initialized=!0,n(),e()})["catch"](function(t){return n(t),r(t)})}}(this))},t.prototype._initializeStores=function(){return new Promise(function(n){return function(t,e){var r,o,i,s;i=[],s=a.defaults(n._storeClasses,a.getStores());for(o in s)r=s[o],i.push({name:o,Class:r.Class,options:r.options});return a.eachSeries(i,function(t,e){return n.log.debug("["+n.name+"] Initializing Store "+t.name),n._storeInstances[t.name]=new t.Class,n._storeInstances[t.name].initialize(n.name,t.options,function(){return n.log.debug("["+n.name+"] Finished initializing Store "+t.name),e()})},function(n){return n?e(n):t()})}}(this))},t.prototype._initializeProjections=function(){return new Promise(function(n){return function(t,e){return a.eachSeries(n._projectionClasses,function(r){var o,i;return o=null,i=r.name,n.log.debug("["+n.name+"] Initializing Projection "+i),c.initializeInstance(r,{},n).then(function(e){return n.log.debug("["+n.name+"] Finished initializing Projection "+i),t(e)})["catch"](function(n){return e(n)})},function(n){return n?e(n):t()})}}(this))},t.prototype._initializeAdapters=function(){return new Promise(function(n){return function(t){var e,r,o,i;i=n._adapterClasses;for(o in i)r=i[o],e=new n._adapterClasses[o],"function"==typeof e.initialize&&e.initialize(),n._adapterInstances[o]=e;return t()}}(this))},t.prototype.getProjection=function(n){return c.getInstance(n)},t.prototype.getAdapter=function(n){return this._adapterInstances[n]},t.prototype.getDomainEvent=function(n){return this._domainEventClasses[n]},t.prototype.getDomainService=function(n){return this._domainServices[n]},t.prototype.getDomainEventsStore=function(){var n;return n=this.get("default domain events store"),this._storeInstances[n]},t.prototype.saveDomainEvent=function(){var n;return n=1<=arguments.length?m.call(arguments,0):[],new Promise(function(t){return function(e,r){var o;return(o=t.getDomainEventsStore()).saveDomainEvent.apply(o,m.call(n).concat([function(n,t){return n?r(n):e(t)}]))}}(this))},t.prototype.findAllDomainEvents=function(){return new Promise(function(n){return function(t,e){return n.getDomainEventsStore().findAllDomainEvents(function(n,r){return n?e(n):t(r)})}}(this))},t.prototype.findDomainEventsByName=function(){var n;return n=1<=arguments.length?m.call(arguments,0):[],new Promise(function(t){return function(e,r){var o;return(o=t.getDomainEventsStore()).findDomainEventsByName.apply(o,m.call(n).concat([function(n,t){return n?r(n):e(t)}]))}}(this))},t.prototype.findDomainEventsByNameAndAggregateId=function(){var n;return n=1<=arguments.length?m.call(arguments,0):[],new Promise(function(t){return function(e,r){var o;return(o=t.getDomainEventsStore()).findDomainEventsByNameAndAggregateId.apply(o,m.call(n).concat([function(n,t){return n?r(n):e(t)}]))}}(this))},t.prototype.findDomainEventsByAggregateId=function(){var n;return n=1<=arguments.length?m.call(arguments,0):[],new Promise(function(t){return function(e,r){var o;return(o=t.getDomainEventsStore()).findDomainEventsByAggregateId.apply(o,m.call(n).concat([function(n,t){return n?r(n):e(t)}]))}}(this))},t.prototype.findDomainEventsByAggregateName=function(){var n;return n=1<=arguments.length?m.call(arguments,0):[],new Promise(function(t){return function(e,r){var o;return(o=t.getDomainEventsStore()).findDomainEventsByAggregateName.apply(o,m.call(n).concat([function(n,t){return n?r(n):e(t)}]))}}(this))},t.prototype.getProjectionStore=function(n,t,e){return new Promise(function(r){return function(o,i){var s;return r._storeInstances[n]?r._storeInstances[n].getProjectionStore(t,function(n,t){return"function"==typeof e&&e(n,t),n?i(n):o(t)}):(s="Requested Store with name "+n+" not found",r.log.error(s),"function"==typeof e&&e(s,null),i(s))}}(this))},t.prototype.clearProjectionStore=function(n,t,e){return new Promise(function(r){return function(o,i){var s;return r._storeInstances[n]?r._storeInstances[n].clearProjectionStore(t,function(n,t){return"function"==typeof e&&e(n,t),n?i(n):o(t)}):(s="Requested Store with name "+n+" not found",r.log.error(s),"function"==typeof e&&e(s,null),i(s))}}(this))},t.prototype.getEventBus=function(){return this._eventBus},t.prototype.command=function(n,t){return this.log.debug("Got Command",n),new Promise(function(e){return function(r,o){var i;return e._initialized?e._commandHandlers[n]?e._commandHandlers[n](t,function(t,i){return e.log.debug("Completed Command",n),a.nextTick(function(){return t?o(t):r(i)})}):(i="Given command "+n+" not registered on context",e.log.error(i),i=new Error(i),o(i)):(i="Context not initialized yet",e.log.error(i),i=new Error(i),o(i))}}(this))},t.prototype.query=function(n,t){return this.log.debug("Got Query",n),new Promise(function(e){return function(r,o){var i;return e._initialized?e._queryHandlers[n]?e._queryHandlers[n](t,function(t,i){return e.log.debug("Completed Query",n),a.nextTick(function(){return t?o(t):r(i)})}):(i="Given query "+n+" not registered on context",e.log.error(i),i=new Error(i),o(i)):(i="Context not initialized yet",e.log.error(i),i=new Error(i),void o(i))}}(this))},t.prototype.enableWaitingMode=function(){return this.set("waiting mode",!0)},t.prototype.disableWaitingMode=function(){return this.set("waiting mode",!1)},t.prototype.isWaitingModeEnabled=function(){return this.get("waiting mode")},t}(s),e.exports=r}),require.register("eventric/src/domain_event",function(n,t,e){var r;r=function(){function n(n){this.id=n.id,this.name=n.name,this.payload=n.payload,this.aggregate=n.aggregate,this.context=n.context,this.timestamp=(new Date).getTime()}return n}(),e.exports=r}),require.register("eventric/src/event_bus",function(n,t,e){var r,o;o=t("./pub_sub"),r=function(){function n(){this._pubSub=new o}return n.prototype.subscribeToDomainEventWithAggregateId=function(n,t,e,r){return null==r&&(r={}),this.subscribeToDomainEvent(""+n+"/"+t,e,r)},n.prototype.subscribeToDomainEvent=function(n,t,e){return null==e&&(e={}),e.isAsync?this._pubSub.subscribeAsync(n,t):this._pubSub.subscribe(n,t)},n.prototype.subscribeToAllDomainEvents=function(n){return this._pubSub.subscribe("DomainEvent",n)},n.prototype.publishDomainEvent=function(n,t){return null==t&&(t=function(){}),this._publish("publish",n,t)},n.prototype.publishDomainEventAndWait=function(n,t){return null==t&&(t=function(){}),this._publish("publishAsync",n,t)},n.prototype._publish=function(n,t,e){return null==e&&(e=function(){}),this._pubSub[n]("DomainEvent",t,function(r){return function(){return r._pubSub[n](t.name,t,function(){return t.aggregate&&t.aggregate.id?r._pubSub[n](""+t.name+"/"+t.aggregate.id,t,e):e()})}}(this))},n}(),e.exports=r}),require.register("eventric/src/index",function(n,t,e){var r,o,i=function(n,t){return function(){return n.apply(t,arguments)}},s=[].slice;o=t("es6-promise"),"undefined"!=typeof e&&"undefined"!=typeof process&&(global.Promise=o.Promise),r=function(){function n(){this._handleRemoteRPCRequest=i(this._handleRemoteRPCRequest,this),this._contexts={},this._params={},this._domainEventHandlers={},this._domainEventHandlersAll=[],this._processManagerService=t("./process_manager"),this._processManagerInstances={},this._storeClasses={},this._remoteEndpoints=[],this.log=t("./logger"),this.addRemoteEndpoint("inmemory",t("./remote_inmemory").endpoint),this.addStore("inmemory",t("./store_inmemory")),this.set("default domain events store","inmemory")}return n.prototype.set=function(n,t){return this._params[n]=t},n.prototype.get=function(n){return n?this._params[n]:this._params},n.prototype.addStore=function(n,t,e){return null==e&&(e={}),this._storeClasses[n]={Class:t,options:e}},n.prototype.getStores=function(){return this._storeClasses},n.prototype.context=function(n){var e,r,o;if(!n)throw o="Contexts must have a name",this.log.error(o),new Error(o);return e=t("./context"),r=new e(n),this._delegateAllDomainEventsToGlobalHandlers(r),this._delegateAllDomainEventsToRemoteEndpoints(r),this._contexts[n]=r,r},n.prototype.getContext=function(n){return this._contexts[n]},n.prototype.remote=function(n){var e,r,o;if(!n)throw r="Missing context name",this.log.error(r),new Error(r);return e=t("./remote"),o=new e(n)},n.prototype.addRemoteEndpoint=function(n,t){return this._remoteEndpoints.push(t),t.setRPCHandler(this._handleRemoteRPCRequest)},n.prototype._handleRemoteRPCRequest=function(n,t){var e,r;return e=this.getContext(n.contextName),e?n.method in e?e[n.method].apply(e,n.params).then(function(n){return t(null,n)})["catch"](function(n){return t(n)}):(r="Remote RPC method "+n.method+" not found on Context "+n.contextName,this.log.error(r),t(r,null)):(r="Tried to handle Remote RPC with not registered context "+n.contextName,this.log.error(r),t(r,null))},n.prototype._delegateAllDomainEventsToGlobalHandlers=function(n){return n.subscribeToAllDomainEvents(function(t){return function(e){var r,o,i,s,u;for(o=t.getDomainEventHandlers(n.name,e.name),u=[],i=0,s=o.length;s>i;i++)r=o[i],u.push(r(e));return u}}(this))},n.prototype._delegateAllDomainEventsToRemoteEndpoints=function(n){return n.subscribeToAllDomainEvents(function(t){return function(e){return t._remoteEndpoints.forEach(function(t){return t.publish(n.name,e.name,e),e.aggregate?t.publish(n.name,e.name,e.aggregate.id,e):void 0})}}(this))},n.prototype.subscribeToDomainEvent=function(){var n,t,e,r,o,i,u;return r=2<=arguments.length?s.call(arguments,0,u=arguments.length-1):(u=0,[]),t=arguments[u++],n=r[0],e=r[1],null==n&&(n="all"),null==e&&(e="all"),"all"===n&&"all"===e?this._domainEventHandlersAll.push(t):(null==(o=this._domainEventHandlers)[n]&&(o[n]={}),null==(i=this._domainEventHandlers[n])[e]&&(i[e]=[]),this._domainEventHandlers[n][e].push(t))},n.prototype.getDomainEventHandlers=function(n,t){var e,r,o,i,s;return[].concat(null!=(e=null!=(r=this._domainEventHandlers[n])?r[t]:void 0)?e:[],null!=(o=null!=(i=this._domainEventHandlers[n])?i.all:void 0)?o:[],null!=(s=this._domainEventHandlersAll)?s:[])},n.prototype.generateUid=function(n){var t,e;return t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},e=n||"-",t()+t()+e+t()+e+t()+e+t()+e+t()+t()+t()},n.prototype.addProcessManager=function(n,t){return this._processManagerService.add(n,t,this)},n.prototype.nextTick=function(n){var t,e;return(t=null!=(e="undefined"!=typeof process&&null!==process?process.nextTick:void 0)?e:setTimeout)(function(){return n()})},n.prototype.defaults=function(n,t){var e,r,o,i;for(e=[].concat(Object.keys(n),Object.keys(t)),o=0,i=e.length;i>o;o++)r=e[o],!n[r]&&t[r]&&(n[r]=t[r]);return n},n.prototype.eachSeries=function(n,t,e){var r,o;return e=e||function(){},Array.isArray(n)&&n.length?(r=0,(o=function(){t(n[r],function(t){t?(e(t),e=function(){}):(++r,r>=n.length?e():o())})})()):e()},n}(),e.exports=new r}),require.register("eventric/src/logger",function(n,t,e){e.exports={_logLevel:1,setLogLevel:function(n){return this._logLevel=function(){switch(n){case"debug":return 0;case"warn":return 1;case"info":return 2;case"error":return 3}}()},debug:function(){return this._logLevel>0?void 0:console.log.apply(console,arguments)},warn:function(){return this._logLevel>1?void 0:console.log.apply(console,arguments)},info:function(){return this._logLevel>2?void 0:console.log.apply(console,arguments)},error:function(){return this._logLevel>3?void 0:console.log.apply(console,arguments)}}}),require.register("eventric/src/process_manager",function(n,t,e){var r;r=function(){function n(){this._processManagerInstances={}}return n.prototype.add=function(n,t,e){var r,o,i,s,u;s=t.initializeWhen,u=[];for(r in s)i=s[r],u.push(function(){var s,u,a;for(a=[],s=0,u=i.length;u>s;s++)o=i[s],a.push(e.subscribeToDomainEvent(r,o,function(o){return function(i){return o._spawnProcessManager(n,t["class"],r,i,e)}}(this)));return a}.call(this));return u},n.prototype._spawnProcessManager=function(n,t,e,r,o){var i,s,u,a,c,l,p;a=o.generateUid(),u=new t,u.$endProcess=function(t){return function(){return t._endProcessManager(n,a)}}(this),i=[];for(s in u)c=u[s],0===s.indexOf("from")&&"function"==typeof c&&i.push(s);return this._subscribeProcessManagerToDomainEvents(u,i,o),u.initialize(r),null==(l=this._processManagerInstances)[n]&&(l[n]={}),null==(p=this._processManagerInstances[n])[a]&&(p[a]={}),this._processManagerInstances[n][a]=u},n.prototype._endProcessManager=function(n,t){return delete this._processManagerInstances[n][t]},n.prototype._subscribeProcessManagerToDomainEvents=function(n,t,e){return e.subscribeToDomainEvent(function(e){return function(r){var o,i,s,u;for(u=[],i=0,s=t.length;s>i;i++)o=t[i],u.push("from"+r.context+"_handle"+r.name===o?e._applyDomainEventToProcessManager(o,r,n):void 0);return u}}(this))},n.prototype._applyDomainEventToProcessManager=function(n,t,e){var r;return e[n]?e[n](t):r=new Error("Tried to apply DomainEvent '"+domainEventName+"' to Projection without a matching handle method")},n}(),e.exports=new r}),require.register("eventric/src/projection",function(n,t,e){var r,o,i=function(n,t){return function(){return n.apply(t,arguments)}};o=t("eventric"),r=function(){function n(){this._applyDomainEventToProjection=i(this._applyDomainEventToProjection,this),this.log=o.log,this._handlerFunctions={},this._projectionInstances={}}return n.prototype.initializeInstance=function(n,t,e){return new Promise(function(r){return function(i,s){var u,a,c,l,p,f,m,g;if(m=n.name,u=n["class"],p=new u,e._di){g=e._di;for(l in g)c=g[l],p[l]=c}return f=o.generateUid(),a=null,p.$subscribeHandlersWithAggregateId=function(n){return a=n},r.log.debug("["+e.name+"] Clearing Projections"),r._clearProjectionStores(p.stores,m,e).then(function(){return r.log.debug("["+e.name+"] Finished clearing Projections"),r._injectStoresIntoProjection(m,p,e)}).then(function(){return r._callInitializeOnProjection(m,p,t,e)}).then(function(){var n,t,o,i;r.log.debug("["+e.name+"] Replaying DomainEvents against Projection "+m),t=[];for(o in p)i=p[o],0===o.indexOf("handle")&&"function"==typeof i&&(n=o.replace(/^handle/,""),t.push(n));return r._applyDomainEventsFromStoreToProjection(p,t,a,e)}).then(function(n){return r.log.debug("["+e.name+"] Finished Replaying DomainEvents against Projection "+m),r._subscribeProjectionToDomainEvents(f,m,p,n,a,e)}).then(function(){return r._projectionInstances[f]=p,e.publish("projection:"+m+":initialized",{id:f,projection:p}),i(f)})["catch"](function(n){return s(n)})}}(this))},n.prototype._callInitializeOnProjection=function(n,t,e,r){return new Promise(function(o){return function(i){return t.initialize?(o.log.debug("["+r.name+"] Calling initialize on Projection "+n),t.initialize(e,function(){return o.log.debug("["+r.name+"] Finished initialize call on Projection "+n),i(t)})):(o.log.debug("["+r.name+"] No initialize function on Projection "+n+" given, skipping"),i(t))}}(this))},n.prototype._injectStoresIntoProjection=function(n,t,e){return new Promise(function(r){return function(i,s){return t.stores?(null==t.$store&&(t.$store={}),o.eachSeries(t.stores,function(o,i){return r.log.debug("["+e.name+"] Injecting ProjectionStore "+o+" into Projection "+n),e.getProjectionStore(o,n,function(s,u){return u?(t.$store[o]=u,r.log.debug("["+e.name+"] Finished Injecting ProjectionStore "+o+" into Projection "+n),i()):void 0})},function(n){return n?s(n):i()})):i()}}(this))},n.prototype._clearProjectionStores=function(n,t,e){return new Promise(function(r){return function(i){return n?o.eachSeries(n,function(n,o){return r.log.debug("["+e.name+"] Clearing ProjectionStore "+n+" for "+t),e.clearProjectionStore(n,t,function(){return r.log.debug("["+e.name+"] Finished clearing ProjectionStore "+n+" for "+t),o()})},function(){return i()}):i()}}(this))},n.prototype._applyDomainEventsFromStoreToProjection=function(n,t,e,r){return new Promise(function(i){return function(s,u){var a;return a=e?r.findDomainEventsByNameAndAggregateId(t,e):r.findDomainEventsByName(t),a.then(function(e){return e&&0!==e.length?o.eachSeries(e,function(t,e){return i._applyDomainEventToProjection(t,n).then(function(){return e()})},function(n){return n?u(n):s(t)}):s(t)})["catch"](function(n){return u(n)})}}(this))},n.prototype._subscribeProjectionToDomainEvents=function(n,t,e,r,o,i){return new Promise(function(s){return function(u){var a,c,l,p,f,m;for(a=function(r,o){return s._applyDomainEventToProjection(r,e).then(function(){return i.publish("projection:"+t+":changed",{id:n,projection:e}),o()})},f=0,m=r.length;m>f;f++)c=r[f],l=o?i.subscribeToDomainEventWithAggregateId(c,o,a,{isAsync:!0}):i.subscribeToDomainEvent(c,a,{isAsync:!0}),null==(p=s._handlerFunctions)[n]&&(p[n]=[]),s._handlerFunctions[n].push(l);return u()}}(this))},n.prototype._applyDomainEventToProjection=function(n,t){return new Promise(function(e){return function(r){return t["handle"+n.name]?2===t["handle"+n.name].length?t["handle"+n.name](n,function(){return r()}):(t["handle"+n.name](n),r()):(e.log.debug("Tried to apply DomainEvent '"+n.name+"' to Projection without a matching handle method"),r())}}(this))},n.prototype.getInstance=function(n){return this._projectionInstances[n]},n.prototype.destroyInstance=function(n,t){var e,r,o,i;for(i=this._handlerFunctions[n],r=0,o=i.length;o>r;r++)e=i[r],t.unsubscribeFromDomainEvent(e);return delete this._handlerFunctions[n],delete this._projectionInstances[n]},n}(),e.exports=new r}),require.register("eventric/src/pub_sub",function(n,t,e){var r,o=[].slice;r=function(){function n(){this._subscribers=[],this._subsrciberId=0,this._nextTick=function(){var n;return n=1<=arguments.length?o.call(arguments,0):[],setTimeout.apply(null,n)}}return n.prototype.subscribe=function(n,t){var e;return e={eventName:n,subscriberFn:t,subscriberId:this._getNextSubscriberId()},this._subscribers.push(e),e.subscriberId},n.prototype.subscribeAsync=function(n,t){var e;return e={eventName:n,subscriberFn:t,subscriberId:this._getNextSubscriberId(),isAsync:!0},this._subscribers.push(e),e.subscriberId},n.prototype.publish=function(n,t,e){var r,o;return null==e&&(e=function(){}),o=this._getRelevantSubscribers(n),r=function(n){return function(){return 0===o.length?e():(o.shift().subscriberFn(t,function(){}),n._nextTick(r,0))}}(this),this._nextTick(r,0)},n.prototype.publishAsync=function(n,t,e){var r,o;return null==e&&(e=function(){}),o=this._getRelevantSubscribers(n),r=function(n){return function(){var i;
return 0===o.length?e():(i=o.shift(),i.isAsync?i.subscriberFn(t,function(){return setTimeout(r,0)}):(i.subscriberFn(t),n._nextTick(r,0)))}}(this),this._nextTick(r,0)},n.prototype._getRelevantSubscribers=function(n){return n?this._subscribers.filter(function(t){return t.eventName===n}):this._subscribers},n.prototype.unsubscribe=function(n){return this._subscribers=this._subscribers.filter(function(t){return t.subscriberId!==n})},n.prototype._getNextSubscriberId=function(){return this._subsrciberId++},n}(),e.exports=r}),require.register("eventric/src/remote",function(n,t,e){var r,o,i,s,u={}.hasOwnProperty,a=function(n,t){function e(){this.constructor=n}for(var r in t)u.call(t,r)&&(n[r]=t[r]);return e.prototype=t.prototype,n.prototype=new e,n.__super__=t.prototype,n};i=t("eventric"),r=t("./pub_sub"),s=t("./projection"),o=function(n){function e(n){this._contextName=n,e.__super__.constructor.apply(this,arguments),this.name=this._contextName,this._params={},this._clients={},this._projectionClasses={},this._projectionInstances={},this._handlerFunctions={},this.addClient("inmemory",t("./remote_inmemory").client),this.set("default client","inmemory")}return a(e,n),e.prototype.set=function(n,t){return this._params[n]=t,this},e.prototype.get=function(n){return this._params[n]},e.prototype.command=function(){return this._rpc("command",arguments)},e.prototype.query=function(){return this._rpc("query",arguments)},e.prototype.findAllDomainEvents=function(){return this._rpc("findAllDomainEvents",arguments)},e.prototype.findDomainEventsByName=function(){return this._rpc("findDomainEventsByName",arguments)},e.prototype.findDomainEventsByAggregateId=function(){return this._rpc("findDomainEventsByAggregateId",arguments)},e.prototype.findDomainEventsByAggregateName=function(){return this._rpc("findDomainEventsByAggregateName",arguments)},e.prototype.findDomainEventsByNameAndAggregateId=function(){return this._rpc("findDomainEventsByNameAndAggregateId",arguments)},e.prototype.subscribeToAllDomainEvents=function(n,t){var e,r;return null==t&&(t={}),r=this.get("default client"),e=this.getClient(r),e.subscribe(this._contextName,n)},e.prototype.subscribeToDomainEvent=function(n,t,e){var r,o;return null==e&&(e={}),o=this.get("default client"),r=this.getClient(o),r.subscribe(this._contextName,n,t)},e.prototype.subscribeToDomainEventWithAggregateId=function(n,t,e,r){var o,i;return null==r&&(r={}),i=this.get("default client"),o=this.getClient(i),o.subscribe(this._contextName,n,t,e)},e.prototype.unsubscribeFromDomainEvent=function(n){var t,e;return e=this.get("default client"),t=this.getClient(e),t.unsubscribe(n)},e.prototype._rpc=function(n,t){return new Promise(function(e){return function(r,o){var i,s;return s=e.get("default client"),i=e.getClient(s),i.rpc({contextName:e._contextName,method:n,params:Array.prototype.slice.call(t)},function(n,t){return n?o(n):r(t)})}}(this))},e.prototype.addClient=function(n,t){return this._clients[n]=t,this},e.prototype.getClient=function(n){return this._clients[n]},e.prototype.addProjection=function(n,t){return this._projectionClasses[n]=t,this},e.prototype.initializeProjectionInstance=function(n,t){var e;return this._projectionClasses[n]?s.initializeInstance({name:n,"class":this._projectionClasses[n]},t,this):(e="Given projection "+n+" not registered on remote",i.log.error(e),e=new Error(e),reject(e))},e.prototype.getProjectionInstance=function(n){return s.getInstance(n)},e.prototype.destroyProjectionInstance=function(n){return s.destroyInstance(n,this)},e}(r),e.exports=o}),require.register("eventric/src/remote_inmemory",function(n,t,e){var r,o,i,s,u,a,c=[].slice;i=t("./pub_sub"),s=null,a=new i,o=function(){function n(){s=function(n){return function(t){return new Promise(function(e,r){return n._handleRPCRequest(t,function(n,t){return n?r(n):e(t)})})}}(this)}return n.prototype.setRPCHandler=function(n){this._handleRPCRequest=n},n.prototype.publish=function(){var n,t,e,r,o,i,s;return t=arguments[0],i=3<=arguments.length?c.call(arguments,1,s=arguments.length-1):(s=1,[]),o=arguments[s++],e=i[0],n=i[1],r=u(t,e,n),a.publish(r,o,function(){})},n}(),e.exports.endpoint=new o,r=function(){function n(){}return n.prototype.rpc=function(n,t){if(!s)throw new Error("No Remote Endpoint available for in memory client");return s(n).then(function(n){return t(null,n)})["catch"](function(n){return t(n)})},n.prototype.subscribe=function(){var n,t,e,r,o,i,s;return t=arguments[0],i=3<=arguments.length?c.call(arguments,1,s=arguments.length-1):(s=1,[]),o=arguments[s++],e=i[0],n=i[1],r=u(t,e,n),a.subscribe(r,o)},n.prototype.unsubscribe=function(n){return a.unsubscribe(n)},n}(),e.exports.client=new r,u=function(n,t,e){var r;return r=n,t&&(r+="/"+t),e&&(r+="/"+e),r}}),require.register("eventric/src/repository",function(n,t,e){var r,o,i,s=function(n,t){return function(){return n.apply(t,arguments)}};i=t("eventric"),r=t("./aggregate"),o=function(){function n(n){this.save=s(this.save,this),this.create=s(this.create,this),this.findById=s(this.findById,this),this._aggregateName=n.aggregateName,this._AggregateRoot=n.AggregateRoot,this._context=n.context,this._command={},this._aggregateInstances={},this._store=this._context.getDomainEventsStore()}return n.prototype.findById=function(n,t){return null==t&&(t=function(){}),new Promise(function(e){return function(o,s){return e._findDomainEventsForAggregate(n,function(u,a){var c,l,p,f;return u?(t(u,null),void s(u)):a.length?(c=new r(e._context,e._aggregateName,e._AggregateRoot),c.applyDomainEvents(a),c.id=n,l=null!=(f=e._command.id)?f:"nocommand",null==(p=e._aggregateInstances)[l]&&(p[l]={}),e._aggregateInstances[l][n]=c,t(null,c.root),o(c.root)):(u="No domainEvents for "+e._aggregateName+" Aggregate with "+n+" available",i.log.error(u),t(u,null),void s(u))})}}(this))},n.prototype._findDomainEventsForAggregate=function(n,t){return this._store.findDomainEventsByAggregateId(n,function(){return function(n,e){return n?t(n,null):0===e.length?t(null,[]):t(null,e)}}(this))},n.prototype.create=function(){var n,t;return t=arguments,"function"==typeof t[t.length-1]&&(n=t.pop()),new Promise(function(e){return function(o){var i;return i=new r(e._context,e._aggregateName,e._AggregateRoot),i.create.apply(i,t).then(function(t){var r,i,s;return r=null!=(s=e._command.id)?s:"nocommand",null==(i=e._aggregateInstances)[r]&&(i[r]={}),e._aggregateInstances[r][t.id]=t,"function"==typeof n&&n(null,t.id),o(t.id)})}}(this))},n.prototype.save=function(n,t){return null==t&&(t=function(){}),new Promise(function(e){return function(r,o){var s,u,a,c,l;return u=null!=(l=e._command.id)?l:"nocommand",(s=e._aggregateInstances[u][n])?(a=s.getDomainEvents(),a.length<1?(c="Tried to save 0 DomainEvents from Aggregate "+e._aggregateName,i.log.debug(c,e._command),c=new Error(c),"function"==typeof t&&t(c,null),void o(c)):(i.log.debug("Going to Save and Publish "+a.length+" DomainEvents from Aggregate "+e._aggregateName),i.eachSeries(a,function(n,t){return n.command=e._command,e._store.saveDomainEvent(n,function(){return i.log.debug("Saved DomainEvent",n),t(null)})},function(n){var u,c,l;if(n)return t(n,null),o(n);if(e._context.isWaitingModeEnabled())return i.eachSeries(a,function(n,t){return i.log.debug("Publishing DomainEvent in waiting mode",n),e._context.getEventBus().publishDomainEventAndWait(n,t)},function(n){return n?(t(n,null),o(n)):(r(s.id),t(null,s.id))});for(c=0,l=a.length;l>c;c++)u=a[c],i.log.debug("Publishing DomainEvent",u),e._context.getEventBus().publishDomainEvent(u,function(){});return r(s.id),t(null,s.id)}))):(c="Tried to save unknown aggregate "+e._aggregateName,i.log.error(c),c=new Error(c),"function"==typeof t&&t(c,null),void o(c))}}(this))},n.prototype.setCommand=function(n){return this._command=n},n}(),e.exports=o}),require.register("eventric/src/store_inmemory",function(n,t,e){var r,o,i=[].slice;o=["domain_events","projections"],r=function(){function n(){}return n.prototype._domainEvents={},n.prototype._projections={},n.prototype.initialize=function(){var n,t,e,r,o;return r=arguments[0],e=3<=arguments.length?i.call(arguments,1,o=arguments.length-1):(o=1,[]),n=arguments[o++],this._contextName=r,t=e[0],this._domainEventsCollectionName=""+this._contextName+".DomainEvents",this._projectionCollectionName=""+this._contextName+".Projections",this._domainEvents[this._domainEventsCollectionName]=[],n()},n.prototype.saveDomainEvent=function(n,t){return this._domainEvents[this._domainEventsCollectionName].push(n),t(null,n)},n.prototype.findAllDomainEvents=function(n){return n(null,this._domainEvents[this._domainEventsCollectionName])},n.prototype.findDomainEventsByName=function(n,t){var e,r;return e=n instanceof Array?function(t){return n.indexOf(t)>-1}:function(t){return t===n},r=this._domainEvents[this._domainEventsCollectionName].filter(function(n){return e(n.name)}),t(null,r)},n.prototype.findDomainEventsByNameAndAggregateId=function(n,t,e){var r,o,i;return o=n instanceof Array?function(t){return n.indexOf(t)>-1}:function(t){return t===n},r=t instanceof Array?function(n){return t.indexOf(n)>-1}:function(n){return n===t},i=this._domainEvents[this._domainEventsCollectionName].filter(function(n){var t;return o(n.name)&&r(null!=(t=n.aggregate)?t.id:void 0)}),e(null,i)},n.prototype.findDomainEventsByAggregateId=function(n,t){var e,r;return e=n instanceof Array?function(t){return n.indexOf(t)>-1}:function(t){return t===n},r=this._domainEvents[this._domainEventsCollectionName].filter(function(n){var t;return e(null!=(t=n.aggregate)?t.id:void 0)}),t(null,r)},n.prototype.findDomainEventsByAggregateName=function(n,t){var e,r;return e=n instanceof Array?function(t){return n.indexOf(t)>-1}:function(t){return t===n},r=this._domainEvents[this._domainEventsCollectionName].filter(function(n){var t;return e(null!=(t=n.aggregate)?t.name:void 0)}),t(null,r)},n.prototype.getProjectionStore=function(n,t){var e,r,o;return null==(e=this._projections)[o=this._projectionCollectionName]&&(e[o]={}),null==(r=this._projections[this._projectionCollectionName])[n]&&(r[n]={}),t(null,this._projections[this._projectionCollectionName][n])},n.prototype.clearProjectionStore=function(n,t){var e,r,o;return null==(e=this._projections)[o=this._projectionCollectionName]&&(e[o]={}),null==(r=this._projections[this._projectionCollectionName])[n]&&(r[n]={}),delete this._projections[this._projectionCollectionName][n],t(null,null)},n.prototype.checkSupport=function(n){return o.indexOf(n)>-1},n}(),e.exports=r});