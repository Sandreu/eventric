!function(){"use strict";var n="undefined"==typeof window?global:window;if("function"!=typeof n.require){var t={},e={_load:function(n,r){var i=e._resolveFilename(n,r),s=t[i];if(!s)throw new Error('Cannot find module "'+i+'" from "'+r+'"');if(e._cache[i])return e._cache[i].exports;var u=o(i),a={id:i,exports:{}};return e._cache[i]=a,s.call(a.exports,a.exports,u,a),a.exports},_cache:{},_resolveFilename:function(n,e){var r=i(s(e),n);return t.hasOwnProperty(r)?r:(r=i(r,"./index"),t.hasOwnProperty(r)?r:n)}},r=function(n,t){return e._load(n,t)},i=function(){var n=/^\.\.?(\/|$)/;return function(t,e){var r,i,o=[];r=(n.test(e)?t+"/"+e:e).split("/");for(var s=0,u=r.length;u>s;s++)i=r[s],".."===i?o.pop():"."!==i&&""!==i&&o.push(i);return o.join("/")}}(),o=function(t){return function(e){return n.require(e,t)}},s=function(n){return n?n.split("/").slice(0,-1).join("/"):""};r.register=r.define=function(n,e){if("object"==typeof n)for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);else t[n]=e},r.list=function(){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e);return n},n.require=r,r.define("module",function(n,t,r){r.exports=e})}}(),require.register("eventric/index",function(n,t,e){e.exports=t("./src")}),require.register("eventric/src/aggregate",function(n,t,e){var r,i,o,s,u,a=function(n,t){return function(){return n.apply(t,arguments)}},c=[].slice;s=t("eventric"),u=t("./helper/underscore"),i=t("./helper/clone"),o=t("./domain_event"),r=function(){function n(n,t,e){this._context=n,this._name=t,this.create=a(this.create,this),this.getDomainEvents=a(this.getDomainEvents,this),this.emitDomainEvent=a(this.emitDomainEvent,this),this._domainEvents=[],this.root=e?new e:{},this.root.$emitDomainEvent=this.emitDomainEvent}return n.prototype.emitDomainEvent=function(n,t){var e,r,i;if(e=this._context.getDomainEvent(n),!e)throw i="Tried to emitDomainEvent '"+n+"' which is not defined",s.log.error(i),new Error(i);return r=this._createDomainEvent(n,e,t),this._domainEvents.push(r),this._handleDomainEvent(n,r),s.log.debug("Created and Handled DomainEvent in Aggregate",r)},n.prototype._createDomainEvent=function(n,t,e){return new o({id:s.generateUid(),name:n,aggregate:{id:this.id,name:this._name},context:this._context.name,payload:new t(e)})},n.prototype._handleDomainEvent=function(n,t){return this.root["handle"+n]?this.root["handle"+n](t,function(){}):s.log.debug("Tried to handle the DomainEvent '"+n+"' without a matching handle method")},n.prototype.getDomainEvents=function(){return this._domainEvents},n.prototype.applyDomainEvents=function(n){var t,e,r,i;for(i=[],e=0,r=n.length;r>e;e++)t=n[e],i.push(this._applyDomainEvent(t));return i},n.prototype._applyDomainEvent=function(n){return this._handleDomainEvent(n.name,n)},n.prototype.create=function(){var n;return n=arguments,new Promise(function(t){return function(e,r){var i,o,u,a;if(t.id=s.generateUid(),"function"!=typeof t.root.create)throw u="No create function on aggregate",s.log.error(u),new Error(u);try{if(i=(a=t.root).create.apply(a,c.call(n).concat([function(n){return n?r(n):e(t)}])),i instanceof Promise)return i.then(function(){return e(t)}),i["catch"](function(n){return r(n)})}catch(l){return o=l,r(o)}}}(this))},n.prototype.toJSON=function(){return i(this.root)},n}(),e.exports=r}),require.register("eventric/src/context",function(n,t,e){var r,i,o,s,u,a,c,l,f,p,h=function(n,t){return function(){return n.apply(t,arguments)}},g={}.hasOwnProperty,m=function(n,t){function e(){this.constructor=n}for(var r in t)g.call(t,r)&&(n[r]=t[r]);return e.prototype=t.prototype,n.prototype=new e,n.__super__=t.prototype,n},d=[].slice;l=t("eventric"),p=t("./helper/underscore"),c=t("./helper/async"),a=t("./repository"),s=t("./event_bus"),o=t("./domain_event"),r=t("./helper/clone"),u=t("./pub_sub"),f=t("./projection"),i=function(n){function t(n){this.name=n,this.clearProjectionStore=h(this.clearProjectionStore,this),this.getProjectionStore=h(this.getProjectionStore,this),this.emitDomainEvent=h(this.emitDomainEvent,this),t.__super__.constructor.apply(this,arguments),this._initialized=!1,this._params=l.get(),this._di={},this._aggregateRootClasses={},this._adapterClasses={},this._adapterInstances={},this._commandHandlers={},this._queryHandlers={},this._domainEventClasses={},this._domainEventHandlers={},this._projectionClasses=[],this._repositoryInstances={},this._domainServices={},this._storeClasses={},this._storeInstances={},this._eventBus=new s}return m(t,n),t.prototype.log=l.log,t.prototype.set=function(n,t){return this._params[n]=t,this},t.prototype.get=function(n){return this._params[n]},t.prototype.emitDomainEvent=function(n,t){var e,r;if(e=this.getDomainEvent(n),!e)throw new Error("Tried to emitDomainEvent '"+n+"' which is not defined");return r=this._createDomainEvent(n,e,t),this.getDomainEventsStore().saveDomainEvent(r,function(n){return function(){return n._eventBus.publishDomainEvent(r,function(){})}}(this))},t.prototype._createDomainEvent=function(n,t,e){return new o({id:l.generateUid(),name:n,context:this.name,payload:new t(e)})},t.prototype.addStore=function(n,t,e){return null==e&&(e={}),this._storeClasses[n]={Class:t,options:e},this},t.prototype.defineDomainEvent=function(n,t){return this._domainEventClasses[n]=t,this},t.prototype.defineDomainEvents=function(n){var t,e;for(e in n)t=n[e],this.defineDomainEvent(e,t);return this},t.prototype.addCommandHandler=function(n,t){return this._commandHandlers[n]=function(e){return function(){var i,o,s,u;return i={id:l.generateUid(),name:n,params:null!=(u=arguments[0])?u:null},s=null,o=r(e._di),o.$repository=function(n){var t,r;return s||(t=e._aggregateRootClasses[n],r=new a({aggregateName:n,AggregateRoot:t,context:e}),s=r),s.setCommand(i),s},t.apply(o,arguments)}}(this),this},t.prototype.addCommandHandlers=function(n){var t,e;for(e in n)t=n[e],this.addCommandHandler(e,t);return this},t.prototype.addQueryHandler=function(n,t){return this._queryHandlers[n]=function(n){return function(){return t.apply(n._di,arguments)}}(this),this},t.prototype.addQueryHandlers=function(n){var t,e;for(e in n)t=n[e],this.addQueryHandler(e,t);return this},t.prototype.addAggregate=function(n,t){return this._aggregateRootClasses[n]=t,this},t.prototype.addAggregates=function(n){var t,e;for(e in n)t=n[e],this.addAggregate(e,t);return this},t.prototype.subscribeToDomainEvent=function(n,t,e){var r;return null==e&&(e={}),r=function(n){return function(){return t.apply(n._di,arguments)}}(this),this._eventBus.subscribeToDomainEvent(n,r,e),this},t.prototype.subscribeToDomainEventWithAggregateId=function(n,t,e,r){var i;return null==r&&(r={}),i=function(n){return function(){return e.apply(n._di,arguments)}}(this),this._eventBus.subscribeToDomainEventWithAggregateId(n,t,i,r)},t.prototype.subscribeToAllDomainEvents=function(n,t){var e;return null==t&&(t={}),e=function(t){return function(){return n.apply(t._di,arguments)}}(this),this._eventBus.subscribeToAllDomainEvents(e,t)},t.prototype.subscribeToDomainEvents=function(n){var t,e;for(t in n)e=n[t],this.subscribeToDomainEvent(t,e);return this},t.prototype.addDomainService=function(n,t){return this._domainServices[n]=function(n){return function(){return t.apply(n._di,arguments)}}(this),this},t.prototype.addDomainServices=function(n){var t,e;for(e in n)t=n[e],this.addDomainService(e,t);return this},t.prototype.addAdapter=function(n,t){return this._adapterClasses[n]=t,this},t.prototype.addAdapters=function(n){var t,e;for(t in n)e=n[t],this.addAdapter(t,e);return this},t.prototype.addProjection=function(n,t){return this._projectionClasses.push({name:n,"class":t}),this},t.prototype.addProjections=function(n){var t,e;for(e in n)t=n[e],this.addProjection(e,t);return this},t.prototype.initialize=function(n){return null==n&&(n=function(){}),new Promise(function(t){return function(e,r){return t.log.debug("["+t.name+"] Initializing"),t.log.debug("["+t.name+"] Initializing Store"),t._initializeStores().then(function(){return t.log.debug("["+t.name+"] Finished initializing Store"),t._di={$adapter:function(){return t.getAdapter.apply(t,arguments)},$query:function(){return t.query.apply(t,arguments)},$domainService:function(){return t.getDomainService(arguments[0]).apply(t,[arguments[1],arguments[2]])},$projectionStore:function(){return t.getProjectionStore.apply(t,arguments)},$emitDomainEvent:function(){return t.emitDomainEvent.apply(t,arguments)}},t.log.debug("["+t.name+"] Initializing Adapters"),t._initializeAdapters()}).then(function(){return t.log.debug("["+t.name+"] Finished initializing Adapters"),t.log.debug("["+t.name+"] Initializing Projections"),t._initializeProjections()}).then(function(){return t.log.debug("["+t.name+"] Finished initializing Projections"),t.log.debug("["+t.name+"] Finished initializing"),t._initialized=!0,n(),e()})["catch"](function(t){return n(t),r(t)})}}(this))},t.prototype._initializeStores=function(){return new Promise(function(n){return function(t,e){var r,i,o,s;o=[],s=p.defaults(n._storeClasses,l.getStores());for(i in s)r=s[i],o.push({name:i,Class:r.Class,options:r.options});return c.eachSeries(o,function(t,e){return n.log.debug("["+n.name+"] Initializing Store "+t.name),n._storeInstances[t.name]=new t.Class,n._storeInstances[t.name].initialize(n.name,t.options,function(){return n.log.debug("["+n.name+"] Finished initializing Store "+t.name),e()})},function(n){return n?e(n):t()})}}(this))},t.prototype._initializeProjections=function(){return new Promise(function(n){return function(t,e){return c.eachSeries(n._projectionClasses,function(r){var i,o;return i=null,o=r.name,n.log.debug("["+n.name+"] Initializing Projection "+o),f.initializeInstance(r,{},n).then(function(e){return n.log.debug("["+n.name+"] Finished initializing Projection "+o),t(e)})["catch"](function(n){return e(n)})},function(n){return n?e(n):t()})}}(this))},t.prototype._initializeAdapters=function(){return new Promise(function(n){return function(t){var e,r,i,o;o=n._adapterClasses;for(i in o)r=o[i],e=new n._adapterClasses[i],"function"==typeof e.initialize&&e.initialize(),n._adapterInstances[i]=e;return t()}}(this))},t.prototype.getProjection=function(n){return f.getInstance(n)},t.prototype.getAdapter=function(n){return this._adapterInstances[n]},t.prototype.getDomainEvent=function(n){return this._domainEventClasses[n]},t.prototype.getDomainService=function(n){return this._domainServices[n]},t.prototype.getDomainEventsStore=function(){var n;return n=this.get("default domain events store"),this._storeInstances[n]},t.prototype.findAllDomainEvents=function(){return new Promise(function(n){return function(t,e){return n.getDomainEventsStore().findAllDomainEvents(function(n,r){return n?e(n):t(r)})}}(this))},t.prototype.findDomainEventsByName=function(){var n;return n=1<=arguments.length?d.call(arguments,0):[],new Promise(function(t){return function(e,r){var i;return(i=t.getDomainEventsStore()).findDomainEventsByName.apply(i,d.call(n).concat([function(n,t){return n?r(n):e(t)}]))}}(this))},t.prototype.findDomainEventsByNameAndAggregateId=function(){var n;return n=1<=arguments.length?d.call(arguments,0):[],new Promise(function(t){return function(e,r){var i;return(i=t.getDomainEventsStore()).findDomainEventsByNameAndAggregateId.apply(i,d.call(n).concat([function(n,t){return n?r(n):e(t)}]))}}(this))},t.prototype.findDomainEventsByAggregateId=function(){var n;return n=1<=arguments.length?d.call(arguments,0):[],new Promise(function(t){return function(e,r){var i;return(i=t.getDomainEventsStore()).findDomainEventsByAggregateId.apply(i,d.call(n).concat([function(n,t){return n?r(n):e(t)}]))}}(this))},t.prototype.findDomainEventsByAggregateName=function(){var n;return n=1<=arguments.length?d.call(arguments,0):[],new Promise(function(t){return function(e,r){var i;return(i=t.getDomainEventsStore()).findDomainEventsByAggregateName.apply(i,d.call(n).concat([function(n,t){return n?r(n):e(t)}]))}}(this))},t.prototype.getProjectionStore=function(n,t,e){return new Promise(function(r){return function(i,o){var s;return r._storeInstances[n]?r._storeInstances[n].getProjectionStore(t,function(n,t){return"function"==typeof e&&e(n,t),n?o(n):i(t)}):(s="Requested Store with name "+n+" not found",r.log.error(s),"function"==typeof e&&e(s,null),o(s))}}(this))},t.prototype.clearProjectionStore=function(n,t,e){return new Promise(function(r){return function(i,o){var s;return r._storeInstances[n]?r._storeInstances[n].clearProjectionStore(t,function(n,t){return"function"==typeof e&&e(n,t),n?o(n):i(t)}):(s="Requested Store with name "+n+" not found",r.log.error(s),"function"==typeof e&&e(s,null),o(s))}}(this))},t.prototype.getEventBus=function(){return this._eventBus},t.prototype.command=function(n,t){return this.log.debug("Got Command",n),new Promise(function(e){return function(r,i){var o;return e._initialized?e._commandHandlers[n]?e._commandHandlers[n](t,function(t,o){return e.log.debug("Completed Command",n),l.nextTick(function(){return t?i(t):r(o)})}):(o="Given command "+n+" not registered on context",e.log.error(o),o=new Error(o),i(o)):(o="Context not initialized yet",e.log.error(o),o=new Error(o),i(o))}}(this))},t.prototype.query=function(n,t){return this.log.debug("Got Query",n),new Promise(function(e){return function(r,i){var o;return e._initialized?e._queryHandlers[n]?e._queryHandlers[n](t,function(t,o){return e.log.debug("Completed Query",n),l.nextTick(function(){return t?i(t):r(o)})}):(o="Given query "+n+" not registered on context",e.log.error(o),o=new Error(o),i(o)):(o="Context not initialized yet",e.log.error(o),o=new Error(o),void i(o))}}(this))},t.prototype.enableWaitingMode=function(){return this.set("waiting mode",!0)},t.prototype.disableWaitingMode=function(){return this.set("waiting mode",!1)},t.prototype.isWaitingModeEnabled=function(){return this.get("waiting mode")},t}(u),e.exports=i}),require.register("eventric/src/domain_event",function(n,t,e){var r;r=function(){function n(n){this.id=n.id,this.name=n.name,this.payload=n.payload,this.aggregate=n.aggregate,this.context=n.context,this.timestamp=(new Date).getTime()}return n}(),e.exports=r}),require.register("eventric/src/event_bus",function(n,t,e){var r,i;i=t("./pub_sub"),r=function(){function n(){this._pubSub=new i}return n.prototype.subscribeToDomainEventWithAggregateId=function(n,t,e,r){return null==r&&(r={}),this.subscribeToDomainEvent(""+n+"/"+t,e,r)},n.prototype.subscribeToDomainEvent=function(n,t,e){return null==e&&(e={}),e.isAsync?this._pubSub.subscribeAsync(n,t):this._pubSub.subscribe(n,t)},n.prototype.subscribeToAllDomainEvents=function(n){return this._pubSub.subscribe("DomainEvent",n)},n.prototype.publishDomainEvent=function(n,t){return null==t&&(t=function(){}),this._publish("publish",n,t)},n.prototype.publishDomainEventAndWait=function(n,t){return null==t&&(t=function(){}),this._publish("publishAsync",n,t)},n.prototype._publish=function(n,t,e){return null==e&&(e=function(){}),this._pubSub[n]("DomainEvent",t,function(r){return function(){return r._pubSub[n](t.name,t,function(){return t.aggregate&&t.aggregate.id?r._pubSub[n](""+t.name+"/"+t.aggregate.id,t,e):e()})}}(this))},n}(),e.exports=r}),require.register("eventric/src/index",function(n,t,e){var r,i=function(n,t){return function(){return n.apply(t,arguments)}},o=[].slice;t("./helper/promise"),r=function(){function n(){this._handleRemoteRPCRequest=i(this._handleRemoteRPCRequest,this),this._contexts={},this._params={},this._domainEventHandlers={},this._domainEventHandlersAll=[],this._processManagerService=t("./process_manager"),this._processManagerInstances={},this._storeClasses={},this._remoteEndpoints=[],this.log=t("./logger"),this.addRemoteEndpoint("inmemory",t("./remote_inmemory").endpoint),this.addStore("inmemory",t("./store_inmemory")),this.set("default domain events store","inmemory")}return n.prototype.set=function(n,t){return this._params[n]=t},n.prototype.get=function(n){return n?this._params[n]:this._params},n.prototype.addStore=function(n,t,e){return null==e&&(e={}),this._storeClasses[n]={Class:t,options:e}},n.prototype.getStores=function(){return this._storeClasses},n.prototype.context=function(n){var e,r,i;if(!n)throw i="Contexts must have a name",this.log.error(i),new Error(i);return e=t("./context"),r=new e(n),this._delegateAllDomainEventsToGlobalHandlers(r),this._delegateAllDomainEventsToRemoteEndpoints(r),this._contexts[n]=r,r},n.prototype.getContext=function(n){return this._contexts[n]},n.prototype.remote=function(n){var e,r,i;if(!n)throw r="Missing context name",this.log.error(r),new Error(r);return e=t("./remote"),i=new e(n)},n.prototype.addRemoteEndpoint=function(n,t){return this._remoteEndpoints.push(t),t.setRPCHandler(this._handleRemoteRPCRequest)},n.prototype._handleRemoteRPCRequest=function(n,t){var e,r;return e=this.getContext(n.contextName),e?n.method in e?e[n.method].apply(e,n.params).then(function(n){return t(null,n)})["catch"](function(n){return t(n)}):(r="Remote RPC method "+n.method+" not found on Context "+n.contextName,this.log.error(r),t(r,null)):(r="Tried to handle Remote RPC with not registered context "+n.contextName,this.log.error(r),t(r,null))},n.prototype._delegateAllDomainEventsToGlobalHandlers=function(n){return n.subscribeToAllDomainEvents(function(t){return function(e){var r,i,o,s,u;for(i=t.getDomainEventHandlers(n.name,e.name),u=[],o=0,s=i.length;s>o;o++)r=i[o],u.push(r(e));return u}}(this))},n.prototype._delegateAllDomainEventsToRemoteEndpoints=function(n){return n.subscribeToAllDomainEvents(function(t){return function(e){return t._remoteEndpoints.forEach(function(t){return t.publish(n.name,e.name,e),e.aggregate?t.publish(n.name,e.name,e.aggregate.id,e):void 0})}}(this))},n.prototype.subscribeToDomainEvent=function(){var n,t,e,r,i,s,u;return r=2<=arguments.length?o.call(arguments,0,u=arguments.length-1):(u=0,[]),t=arguments[u++],n=r[0],e=r[1],null==n&&(n="all"),null==e&&(e="all"),"all"===n&&"all"===e?this._domainEventHandlersAll.push(t):(null==(i=this._domainEventHandlers)[n]&&(i[n]={}),null==(s=this._domainEventHandlers[n])[e]&&(s[e]=[]),this._domainEventHandlers[n][e].push(t))},n.prototype.getDomainEventHandlers=function(n,t){var e,r,i,o,s;return[].concat(null!=(e=null!=(r=this._domainEventHandlers[n])?r[t]:void 0)?e:[],null!=(i=null!=(o=this._domainEventHandlers[n])?o.all:void 0)?i:[],null!=(s=this._domainEventHandlersAll)?s:[])},n.prototype.generateUid=function(n){var t,e;return t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},e=n||"-",t()+t()+e+t()+e+t()+e+t()+e+t()+t()+t()},n.prototype.addProcessManager=function(n,t){return this._processManagerService.add(n,t,this)},n.prototype.nextTick=function(n){var t,e;return(t=null!=(e="undefined"!=typeof process&&null!==process?process.nextTick:void 0)?e:setTimeout)(function(){return n()})},n}(),e.exports=new r}),require.register("eventric/src/logger",function(n,t,e){e.exports={_logLevel:1,setLogLevel:function(n){return this._logLevel=function(){switch(n){case"debug":return 0;case"warn":return 1;case"info":return 2;case"error":return 3}}()},debug:function(){return this._logLevel>0?void 0:console.log.apply(console,arguments)},warn:function(){return this._logLevel>1?void 0:console.log.apply(console,arguments)},info:function(){return this._logLevel>2?void 0:console.log.apply(console,arguments)},error:function(){return this._logLevel>3?void 0:console.log.apply(console,arguments)}}}),require.register("eventric/src/process_manager",function(n,t,e){var r;r=function(){function n(){this._processManagerInstances={}}return n.prototype.add=function(n,t,e){var r,i,o,s,u;s=t.initializeWhen,u=[];for(r in s)o=s[r],u.push(function(){var s,u,a;for(a=[],s=0,u=o.length;u>s;s++)i=o[s],a.push(e.subscribeToDomainEvent(r,i,function(i){return function(o){return i._spawnProcessManager(n,t["class"],r,o,e)}}(this)));return a}.call(this));return u},n.prototype._spawnProcessManager=function(n,t,e,r,i){var o,s,u,a,c,l,f;a=i.generateUid(),u=new t,u.$endProcess=function(t){return function(){return t._endProcessManager(n,a)}}(this),o=[];for(s in u)c=u[s],0===s.indexOf("from")&&"function"==typeof c&&o.push(s);return this._subscribeProcessManagerToDomainEvents(u,o,i),u.initialize(r),null==(l=this._processManagerInstances)[n]&&(l[n]={}),null==(f=this._processManagerInstances[n])[a]&&(f[a]={}),this._processManagerInstances[n][a]=u},n.prototype._endProcessManager=function(n,t){return delete this._processManagerInstances[n][t]},n.prototype._subscribeProcessManagerToDomainEvents=function(n,t,e){return e.subscribeToDomainEvent(function(e){return function(r){var i,o,s,u;for(u=[],o=0,s=t.length;s>o;o++)i=t[o],u.push("from"+r.context+"_handle"+r.name===i?e._applyDomainEventToProcessManager(i,r,n):void 0);return u}}(this))},n.prototype._applyDomainEventToProcessManager=function(n,t,e){var r;return e[n]?e[n](t):r=new Error("Tried to apply DomainEvent '"+domainEventName+"' to Projection without a matching handle method")},n}(),e.exports=new r}),require.register("eventric/src/projection",function(n,t,e){var r,i,o,s=function(n,t){return function(){return n.apply(t,arguments)}};o=t("eventric"),i=t("./helper/async"),r=function(){function n(){this._applyDomainEventToProjection=s(this._applyDomainEventToProjection,this),this.log=o.log,this._handlerFunctions={},this._projectionInstances={}}return n.prototype.initializeInstance=function(n,t,e){return new Promise(function(r){return function(i,s){var u,a,c,l,f,p,h,g;if(h=n.name,u=n["class"],f=new u,e._di){g=e._di;for(l in g)c=g[l],f[l]=c}return p=o.generateUid(),a=null,f.$subscribeHandlersWithAggregateId=function(n){return a=n},r.log.debug("["+e.name+"] Clearing Projections"),r._clearProjectionStores(f.stores,h,e).then(function(){return r.log.debug("["+e.name+"] Finished clearing Projections"),r._injectStoresIntoProjection(h,f,e)}).then(function(){return r._callInitializeOnProjection(h,f,t,e)}).then(function(){var n,t,i,o;r.log.debug("["+e.name+"] Replaying DomainEvents against Projection "+h),t=[];for(i in f)o=f[i],0===i.indexOf("handle")&&"function"==typeof o&&(n=i.replace(/^handle/,""),t.push(n));return r._applyDomainEventsFromStoreToProjection(f,t,a,e)}).then(function(n){return r.log.debug("["+e.name+"] Finished Replaying DomainEvents against Projection "+h),r._subscribeProjectionToDomainEvents(p,h,f,n,a,e)}).then(function(){return r._projectionInstances[p]=f,e.publish("projection:"+h+":initialized",{id:p,projection:f}),i(p)})["catch"](function(n){return s(n)})}}(this))},n.prototype._callInitializeOnProjection=function(n,t,e,r){return new Promise(function(i){return function(o){return t.initialize?(i.log.debug("["+r.name+"] Calling initialize on Projection "+n),t.initialize(e,function(){return i.log.debug("["+r.name+"] Finished initialize call on Projection "+n),o(t)})):(i.log.debug("["+r.name+"] No initialize function on Projection "+n+" given, skipping"),o(t))}}(this))},n.prototype._injectStoresIntoProjection=function(n,t,e){return new Promise(function(r){return function(o,s){return t.stores?(null==t.$store&&(t.$store={}),i.eachSeries(t.stores,function(i,o){return r.log.debug("["+e.name+"] Injecting ProjectionStore "+i+" into Projection "+n),e.getProjectionStore(i,n,function(s,u){return u?(t.$store[i]=u,r.log.debug("["+e.name+"] Finished Injecting ProjectionStore "+i+" into Projection "+n),o()):void 0})},function(n){return n?s(n):o()})):o()}}(this))},n.prototype._clearProjectionStores=function(n,t,e){return new Promise(function(r){return function(o){return n?i.eachSeries(n,function(n,i){return r.log.debug("["+e.name+"] Clearing ProjectionStore "+n+" for "+t),e.clearProjectionStore(n,t,function(){return r.log.debug("["+e.name+"] Finished clearing ProjectionStore "+n+" for "+t),i()})},function(){return o()}):o()}}(this))},n.prototype._applyDomainEventsFromStoreToProjection=function(n,t,e,r){return new Promise(function(o){return function(s,u){var a;return a=e?r.findDomainEventsByNameAndAggregateId(t,e):r.findDomainEventsByName(t),a.then(function(e){return e&&0!==e.length?i.eachSeries(e,function(t,e){return o._applyDomainEventToProjection(t,n).then(function(){return e()})},function(n){return n?u(n):s(t)}):s(t)})["catch"](function(n){return u(n)})}}(this))},n.prototype._subscribeProjectionToDomainEvents=function(n,t,e,r,i,o){return new Promise(function(s){return function(u){var a,c,l,f,p,h;for(a=function(r,i){return s._applyDomainEventToProjection(r,e).then(function(){return o.publish("projection:"+t+":changed",{id:n,projection:e}),i()})},p=0,h=r.length;h>p;p++)c=r[p],l=i?o.subscribeToDomainEventWithAggregateId(c,i,a,{isAsync:!0}):o.subscribeToDomainEvent(c,a,{isAsync:!0}),null==(f=s._handlerFunctions)[n]&&(f[n]=[]),s._handlerFunctions[n].push(l);return u()}}(this))},n.prototype._applyDomainEventToProjection=function(n,t){return new Promise(function(e){return function(r){return t["handle"+n.name]?2===t["handle"+n.name].length?t["handle"+n.name](n,function(){return r()}):(t["handle"+n.name](n),r()):(e.log.debug("Tried to apply DomainEvent '"+n.name+"' to Projection without a matching handle method"),r())}}(this))},n.prototype.getInstance=function(n){return this._projectionInstances[n]},n.prototype.destroyInstance=function(n,t){var e,r,i,o;for(o=this._handlerFunctions[n],r=0,i=o.length;i>r;r++)e=o[r],t.unsubscribeFromDomainEvent(e);return delete this._handlerFunctions[n],delete this._projectionInstances[n]},n}(),e.exports=new r}),require.register("eventric/src/pub_sub",function(n,t,e){var r,i=[].slice;r=function(){function n(){this._subscribers=[],this._subsrciberId=0,this._nextTick=function(){var n;return n=1<=arguments.length?i.call(arguments,0):[],setTimeout.apply(null,n)}}return n.prototype.subscribe=function(n,t){var e;return e={eventName:n,subscriberFn:t,subscriberId:this._getNextSubscriberId()},this._subscribers.push(e),e.subscriberId},n.prototype.subscribeAsync=function(n,t){var e;return e={eventName:n,subscriberFn:t,subscriberId:this._getNextSubscriberId(),isAsync:!0},this._subscribers.push(e),e.subscriberId},n.prototype.publish=function(n,t,e){var r,i;return null==e&&(e=function(){}),i=this._getRelevantSubscribers(n),r=function(n){return function(){return 0===i.length?e():(i.shift().subscriberFn(t,function(){}),n._nextTick(r,0))}}(this),this._nextTick(r,0)},n.prototype.publishAsync=function(n,t,e){var r,i;return null==e&&(e=function(){}),i=this._getRelevantSubscribers(n),r=function(n){return function(){var o;return 0===i.length?e():(o=i.shift(),o.isAsync?o.subscriberFn(t,function(){return setTimeout(r,0)}):(o.subscriberFn(t),n._nextTick(r,0)))}}(this),this._nextTick(r,0)},n.prototype._getRelevantSubscribers=function(n){return n?this._subscribers.filter(function(t){return t.eventName===n}):this._subscribers},n.prototype.unsubscribe=function(n){return this._subscribers=this._subscribers.filter(function(t){return t.subscriberId!==n})},n.prototype._getNextSubscriberId=function(){return this._subsrciberId++},n}(),e.exports=r}),require.register("eventric/src/remote",function(n,t,e){var r,i,o,s,u={}.hasOwnProperty,a=function(n,t){function e(){this.constructor=n}for(var r in t)u.call(t,r)&&(n[r]=t[r]);return e.prototype=t.prototype,n.prototype=new e,n.__super__=t.prototype,n};o=t("eventric"),r=t("./pub_sub"),s=t("./projection"),i=function(n){function e(n){this._contextName=n,e.__super__.constructor.apply(this,arguments),this.name=this._contextName,this._params={},this._clients={},this._projectionClasses={},this._projectionInstances={},this._handlerFunctions={},this.addClient("inmemory",t("./remote_inmemory").client),this.set("default client","inmemory")}return a(e,n),e.prototype.set=function(n,t){return this._params[n]=t,this},e.prototype.get=function(n){return this._params[n]},e.prototype.command=function(){return this._rpc("command",arguments)},e.prototype.query=function(){return this._rpc("query",arguments)},e.prototype.findAllDomainEvents=function(){return this._rpc("findAllDomainEvents",arguments)},e.prototype.findDomainEventsByName=function(){return this._rpc("findDomainEventsByName",arguments)},e.prototype.findDomainEventsByAggregateId=function(){return this._rpc("findDomainEventsByAggregateId",arguments)},e.prototype.findDomainEventsByAggregateName=function(){return this._rpc("findDomainEventsByAggregateName",arguments)},e.prototype.findDomainEventsByNameAndAggregateId=function(){return this._rpc("findDomainEventsByNameAndAggregateId",arguments)},e.prototype.subscribeToAllDomainEvents=function(n,t){var e,r;return null==t&&(t={}),r=this.get("default client"),e=this.getClient(r),e.subscribe(this._contextName,n)},e.prototype.subscribeToDomainEvent=function(n,t,e){var r,i;return null==e&&(e={}),i=this.get("default client"),r=this.getClient(i),r.subscribe(this._contextName,n,t)},e.prototype.subscribeToDomainEventWithAggregateId=function(n,t,e,r){var i,o;return null==r&&(r={}),o=this.get("default client"),i=this.getClient(o),i.subscribe(this._contextName,n,t,e)},e.prototype.unsubscribeFromDomainEvent=function(n){var t,e;return e=this.get("default client"),t=this.getClient(e),t.unsubscribe(n)},e.prototype._rpc=function(n,t){return new Promise(function(e){return function(r,i){var o,s;return s=e.get("default client"),o=e.getClient(s),o.rpc({contextName:e._contextName,method:n,params:Array.prototype.slice.call(t)},function(n,t){return n?i(n):r(t)})}}(this))},e.prototype.addClient=function(n,t){return this._clients[n]=t,this},e.prototype.getClient=function(n){return this._clients[n]},e.prototype.addProjection=function(n,t){return this._projectionClasses[n]=t,this},e.prototype.initializeProjectionInstance=function(n,t){var e;return this._projectionClasses[n]?s.initializeInstance({name:n,"class":this._projectionClasses[n]},t,this):(e="Given projection "+n+" not registered on remote",o.log.error(e),e=new Error(e),reject(e))},e.prototype.getProjectionInstance=function(n){return s.getInstance(n)},e.prototype.destroyProjectionInstance=function(n){return s.destroyInstance(n,this)},e}(r),e.exports=i}),require.register("eventric/src/remote_inmemory",function(n,t,e){var r,i,o,s,u,a,c=[].slice;o=t("./pub_sub"),s=null,a=new o,i=function(){function n(){s=function(n){return function(t){return new Promise(function(e,r){return n._handleRPCRequest(t,function(n,t){return n?r(n):e(t)})})}}(this)}return n.prototype.setRPCHandler=function(n){this._handleRPCRequest=n},n.prototype.publish=function(){var n,t,e,r,i,o,s;return t=arguments[0],o=3<=arguments.length?c.call(arguments,1,s=arguments.length-1):(s=1,[]),i=arguments[s++],e=o[0],n=o[1],r=u(t,e,n),a.publish(r,i,function(){})},n}(),e.exports.endpoint=new i,r=function(){function n(){}return n.prototype.rpc=function(n,t){if(!s)throw new Error("No Remote Endpoint available for in memory client");return s(n).then(function(n){return t(null,n)})["catch"](function(n){return t(n)})},n.prototype.subscribe=function(){var n,t,e,r,i,o,s;return t=arguments[0],o=3<=arguments.length?c.call(arguments,1,s=arguments.length-1):(s=1,[]),i=arguments[s++],e=o[0],n=o[1],r=u(t,e,n),a.subscribe(r,i)},n.prototype.unsubscribe=function(n){return a.unsubscribe(n)},n}(),e.exports.client=new r,u=function(n,t,e){var r;return r=n,t&&(r+="/"+t),e&&(r+="/"+e),r}}),require.register("eventric/src/repository",function(n,t,e){var r,i,o,s,u,a=function(n,t){return function(){return n.apply(t,arguments)}};s=t("eventric"),u=t("./helper/underscore"),o=t("./helper/async"),r=t("./aggregate"),i=function(){function n(n){this.save=a(this.save,this),this.create=a(this.create,this),this.findById=a(this.findById,this),this._aggregateName=n.aggregateName,this._AggregateRoot=n.AggregateRoot,this._context=n.context,this._command={},this._aggregateInstances={},this._store=this._context.getDomainEventsStore()}return n.prototype.findById=function(n,t){return null==t&&(t=function(){}),new Promise(function(e){return function(i,o){return e._findDomainEventsForAggregate(n,function(u,a){var c,l,f,p;return u?(t(u,null),void o(u)):a.length?(c=new r(e._context,e._aggregateName,e._AggregateRoot),c.applyDomainEvents(a),c.id=n,l=null!=(p=e._command.id)?p:"nocommand",null==(f=e._aggregateInstances)[l]&&(f[l]={}),e._aggregateInstances[l][n]=c,t(null,c.root),i(c.root)):(u="No domainEvents for "+e._aggregateName+" Aggregate with "+n+" available",s.log.error(u),t(u,null),void o(u))
})}}(this))},n.prototype._findDomainEventsForAggregate=function(n,t){return this._store.findDomainEventsByAggregateId(n,function(){return function(n,e){return n?t(n,null):0===e.length?t(null,[]):t(null,e)}}(this))},n.prototype.create=function(){var n,t;return t=arguments,"function"==typeof t[t.length-1]&&(n=t.pop()),new Promise(function(e){return function(i){var o;return o=new r(e._context,e._aggregateName,e._AggregateRoot),o.create.apply(o,t).then(function(t){var r,o,s;return r=null!=(s=e._command.id)?s:"nocommand",null==(o=e._aggregateInstances)[r]&&(o[r]={}),e._aggregateInstances[r][t.id]=t,"function"==typeof n&&n(null,t.id),i(t.id)})}}(this))},n.prototype.save=function(n,t){return null==t&&(t=function(){}),new Promise(function(e){return function(r,i){var u,a,c,l,f;return a=null!=(f=e._command.id)?f:"nocommand",(u=e._aggregateInstances[a][n])?(c=u.getDomainEvents(),c.length<1?(l="Tried to save 0 DomainEvents from Aggregate "+e._aggregateName,s.log.debug(l,e._command),l=new Error(l),"function"==typeof t&&t(l,null),void i(l)):(s.log.debug("Going to Save and Publish "+c.length+" DomainEvents from Aggregate "+e._aggregateName),o.eachSeries(c,function(n,t){return n.command=e._command,e._store.saveDomainEvent(n,function(){return s.log.debug("Saved DomainEvent",n),t(null)})},function(n){var a,l,f;if(n)return t(n,null),i(n);if(e._context.isWaitingModeEnabled())return o.eachSeries(c,function(n,t){return s.log.debug("Publishing DomainEvent in waiting mode",n),e._context.getEventBus().publishDomainEventAndWait(n,t)},function(n){return n?(t(n,null),i(n)):(r(u.id),t(null,u.id))});for(l=0,f=c.length;f>l;l++)a=c[l],s.log.debug("Publishing DomainEvent",a),e._context.getEventBus().publishDomainEvent(a,function(){});return r(u.id),t(null,u.id)}))):(l="Tried to save unknown aggregate "+e._aggregateName,s.log.error(l),l=new Error(l),"function"==typeof t&&t(l,null),void i(l))}}(this))},n.prototype.setCommand=function(n){return this._command=n},n}(),e.exports=i}),require.register("eventric/src/store_inmemory",function(n,t,e){var r,i,o=[].slice;i=["domain_events","projections"],r=function(){function n(){}return n.prototype._domainEvents={},n.prototype._projections={},n.prototype.initialize=function(){var n,t,e,r,i;return r=arguments[0],e=3<=arguments.length?o.call(arguments,1,i=arguments.length-1):(i=1,[]),n=arguments[i++],this._contextName=r,t=e[0],this._domainEventsCollectionName=""+this._contextName+".DomainEvents",this._projectionCollectionName=""+this._contextName+".Projections",this._domainEvents[this._domainEventsCollectionName]=[],n()},n.prototype.saveDomainEvent=function(n,t){return this._domainEvents[this._domainEventsCollectionName].push(n),t(null,n)},n.prototype.findAllDomainEvents=function(n){return n(null,this._domainEvents[this._domainEventsCollectionName])},n.prototype.findDomainEventsByName=function(n,t){var e,r;return e=n instanceof Array?function(t){return n.indexOf(t)>-1}:function(t){return t===n},r=this._domainEvents[this._domainEventsCollectionName].filter(function(n){return e(n.name)}),t(null,r)},n.prototype.findDomainEventsByNameAndAggregateId=function(n,t,e){var r,i,o;return i=n instanceof Array?function(t){return n.indexOf(t)>-1}:function(t){return t===n},r=t instanceof Array?function(n){return t.indexOf(n)>-1}:function(n){return n===t},o=this._domainEvents[this._domainEventsCollectionName].filter(function(n){var t;return i(n.name)&&r(null!=(t=n.aggregate)?t.id:void 0)}),e(null,o)},n.prototype.findDomainEventsByAggregateId=function(n,t){var e,r;return e=n instanceof Array?function(t){return n.indexOf(t)>-1}:function(t){return t===n},r=this._domainEvents[this._domainEventsCollectionName].filter(function(n){var t;return e(null!=(t=n.aggregate)?t.id:void 0)}),t(null,r)},n.prototype.findDomainEventsByAggregateName=function(n,t){var e,r;return e=n instanceof Array?function(t){return n.indexOf(t)>-1}:function(t){return t===n},r=this._domainEvents[this._domainEventsCollectionName].filter(function(n){var t;return e(null!=(t=n.aggregate)?t.name:void 0)}),t(null,r)},n.prototype.getProjectionStore=function(n,t){var e,r,i;return null==(e=this._projections)[i=this._projectionCollectionName]&&(e[i]={}),null==(r=this._projections[this._projectionCollectionName])[n]&&(r[n]={}),t(null,this._projections[this._projectionCollectionName][n])},n.prototype.clearProjectionStore=function(n,t){var e,r,i;return null==(e=this._projections)[i=this._projectionCollectionName]&&(e[i]={}),null==(r=this._projections[this._projectionCollectionName])[n]&&(r[n]={}),delete this._projections[this._projectionCollectionName][n],t(null,null)},n.prototype.checkSupport=function(n){return i.indexOf(n)>-1},n}(),e.exports=r}),require.register("eventric/src/helper/async",function(n,t,e){!function(){function n(n){var e=!1;return function(){if(e)throw new Error("Callback was already called.");e=!0,n.apply(t,arguments)}}var t,r,i={};t=this,null!=t&&(r=t.async),i.noConflict=function(){return t.async=r,i};var o=Object.prototype.toString,s=Array.isArray||function(n){return"[object Array]"===o.call(n)},u=function(n,t){if(n.forEach)return n.forEach(t);for(var e=0;e<n.length;e+=1)t(n[e],e,n)};"undefined"!=typeof process&&process.nextTick?(i.nextTick=process.nextTick,i.setImmediate="undefined"!=typeof setImmediate?function(n){setImmediate(n)}:i.nextTick):"function"==typeof setImmediate?(i.nextTick=function(n){setImmediate(n)},i.setImmediate=i.nextTick):(i.nextTick=function(n){setTimeout(n,0)},i.setImmediate=i.nextTick),i.eachSeries=function(n,t,e){if(e=e||function(){},!n.length)return e();var r=0,i=function(){t(n[r],function(t){t?(e(t),e=function(){}):(r+=1,r>=n.length?e():i())})};i()},i.forEachSeries=i.eachSeries,i.iterator=function(n){var t=function(e){var r=function(){return n.length&&n[e].apply(null,arguments),r.next()};return r.next=function(){return e<n.length-1?t(e+1):null},r};return t(0)},i.whilst=function(n,t,e){n()?t(function(r){return r?e(r):void i.whilst(n,t,e)}):e()},i.queue=function(t,e){function r(n,t,e,r){return n.started||(n.started=!0),s(t)||(t=[t]),0==t.length?i.setImmediate(function(){n.drain&&n.drain()}):void u(t,function(t){var o={data:t,callback:"function"==typeof r?r:null};e?n.tasks.unshift(o):n.tasks.push(o),n.saturated&&n.tasks.length===n.concurrency&&n.saturated(),i.setImmediate(n.process)})}void 0===e&&(e=1);var o=0,a={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(n,t){r(a,n,!1,t)},kill:function(){a.drain=null,a.tasks=[]},unshift:function(n,t){r(a,n,!0,t)},process:function(){if(!a.paused&&o<a.concurrency&&a.tasks.length){var e=a.tasks.shift();a.empty&&0===a.tasks.length&&a.empty(),o+=1;var r=function(){o-=1,e.callback&&e.callback.apply(e,arguments),a.drain&&a.tasks.length+o===0&&a.drain(),a.process()},i=n(r);t(e.data,i)}},length:function(){return a.tasks.length},running:function(){return o},idle:function(){return a.tasks.length+o===0},pause:function(){a.paused!==!0&&(a.paused=!0,a.process())},resume:function(){a.paused!==!1&&(a.paused=!1,a.process())}};return a},e.exports=i}()}),require.register("eventric/src/helper/clone",function(n,t,e){"use strict";function r(n){return Object.prototype.toString.call(n)}function i(n,t,e,r){function i(n,e){if(null===n)return null;if(0==e)return n;var c;if("object"!=typeof n)return n;if(o.isArray(n)?c=[]:o.isRegExp(n)?(c=new RegExp(n.source,o.getRegExpFlags(n)),n.lastIndex&&(c.lastIndex=n.lastIndex)):o.isDate(n)?c=new Date(n.getTime()):a&&Buffer.isBuffer(n)?(c=new Buffer(n.length),n.copy(c)):c=Object.create("undefined"==typeof r?Object.getPrototypeOf(n):r),t){var l=s.indexOf(n);if(-1!=l)return u[l];s.push(n),u.push(c)}for(var f in n)c[f]=i(n[f],e-1);return c}var s=[],u=[],a="undefined"!=typeof Buffer;return"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=1/0),i(n,e)}var o={isArray:function(n){return Array.isArray(n)||"object"==typeof n&&"[object Array]"===r(n)},isDate:function(n){return"object"==typeof n&&"[object Date]"===r(n)},isRegExp:function(n){return"object"==typeof n&&"[object RegExp]"===r(n)},getRegExpFlags:function(n){var t="";return n.global&&(t+="g"),n.ignoreCase&&(t+="i"),n.multiline&&(t+="m"),t}};"object"==typeof e&&(e.exports=i),i.clonePrototype=function(n){if(null===n)return null;var t=function(){};return t.prototype=n,new t},e.exports=i}),require.register("eventric/src/helper/promise",function(){!function(){var n,t,e,r;!function(){var i={},o={};n=function(n,t,e){i[n]={deps:t,callback:e}},r=e=t=function(n){function e(t){if("."!==t.charAt(0))return t;for(var e=t.split("/"),r=n.split("/").slice(0,-1),i=0,o=e.length;o>i;i++){var s=e[i];if(".."===s)r.pop();else{if("."===s)continue;r.push(s)}}return r.join("/")}if(r._eak_seen=i,o[n])return o[n];if(o[n]={},!i[n])throw new Error("Could not find module "+n);for(var s,u=i[n],a=u.deps,c=u.callback,l=[],f=0,p=a.length;p>f;f++)l.push("exports"===a[f]?s={}:t(e(a[f])));var h=c.apply(this,l);return o[n]=s||h}}(),n("promise/all",["./utils","exports"],function(n,t){"use strict";function e(n){var t=this;if(!r(n))throw new TypeError("You must pass an array to all.");return new t(function(t,e){function r(n){return function(t){o(n,t)}}function o(n,e){u[n]=e,0===--a&&t(u)}var s,u=[],a=n.length;0===a&&t([]);for(var c=0;c<n.length;c++)s=n[c],s&&i(s.then)?s.then(r(c),e):o(c,s)})}var r=n.isArray,i=n.isFunction;t.all=e}),n("promise/asap",["exports"],function(n){"use strict";function t(){return function(){process.nextTick(i)}}function e(){var n=0,t=new a(i),e=document.createTextNode("");return t.observe(e,{characterData:!0}),function(){e.data=n=++n%2}}function r(){return function(){c.setTimeout(i,1)}}function i(){for(var n=0;n<l.length;n++){var t=l[n],e=t[0],r=t[1];e(r)}l=[]}function o(n,t){var e=l.push([n,t]);1===e&&s()}var s,u="undefined"!=typeof window?window:{},a=u.MutationObserver||u.WebKitMutationObserver,c="undefined"!=typeof global?global:void 0===this?window:this,l=[];s="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?t():a?e():r(),n.asap=o}),n("promise/config",["exports"],function(n){"use strict";function t(n,t){return 2!==arguments.length?e[n]:void(e[n]=t)}var e={instrument:!1};n.config=e,n.configure=t}),n("promise/polyfill",["./promise","./utils","exports"],function(n,t,e){"use strict";function r(){var n;n="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var t="Promise"in n&&"resolve"in n.Promise&&"reject"in n.Promise&&"all"in n.Promise&&"race"in n.Promise&&function(){var t;return new n.Promise(function(n){t=n}),o(t)}();t||(n.Promise=i)}var i=n.Promise,o=t.isFunction;e.polyfill=r}),n("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(n,t,e,r,i,o,s,u){"use strict";function a(n){if(!E(n))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof a))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],c(n,this)}function c(n,t){function e(n){g(t,n)}function r(n){d(t,n)}try{n(e,r)}catch(i){r(i)}}function l(n,t,e,r){var i,o,s,u,a=E(e);if(a)try{i=e(r),s=!0}catch(c){u=!0,o=c}else i=r,s=!0;h(t,i)||(a&&s?g(t,i):u?d(t,o):n===S?g(t,i):n===C&&d(t,i))}function f(n,t,e,r){var i=n._subscribers,o=i.length;i[o]=t,i[o+S]=e,i[o+C]=r}function p(n,t){for(var e,r,i=n._subscribers,o=n._detail,s=0;s<i.length;s+=3)e=i[s],r=i[s+t],l(t,e,r,o);n._subscribers=null}function h(n,t){var e,r=null;try{if(n===t)throw new TypeError("A promises callback cannot return that same promise.");if(b(t)&&(r=t.then,E(r)))return r.call(t,function(r){return e?!0:(e=!0,void(t!==r?g(n,r):m(n,r)))},function(t){return e?!0:(e=!0,void d(n,t))}),!0}catch(i){return e?!0:(d(n,i),!0)}return!1}function g(n,t){n===t?m(n,t):h(n,t)||m(n,t)}function m(n,t){n._state===A&&(n._state=I,n._detail=t,_.async(v,n))}function d(n,t){n._state===A&&(n._state=I,n._detail=t,_.async(y,n))}function v(n){p(n,n._state=S)}function y(n){p(n,n._state=C)}var _=n.config,b=(n.configure,t.objectOrFunction),E=t.isFunction,w=(t.now,e.all),D=r.race,j=i.resolve,x=o.reject,P=s.asap;_.async=P;var A=void 0,I=0,S=1,C=2;a.prototype={constructor:a,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(n,t){var e=this,r=new this.constructor(function(){});if(this._state){var i=arguments;_.async(function(){l(e._state,r,i[e._state-1],e._detail)})}else f(this,r,n,t);return r},"catch":function(n){return this.then(null,n)}},a.all=w,a.race=D,a.resolve=j,a.reject=x,u.Promise=a}),n("promise/race",["./utils","exports"],function(n,t){"use strict";function e(n){var t=this;if(!r(n))throw new TypeError("You must pass an array to race.");return new t(function(t,e){for(var r,i=0;i<n.length;i++)r=n[i],r&&"function"==typeof r.then?r.then(t,e):t(r)})}var r=n.isArray;t.race=e}),n("promise/reject",["exports"],function(n){"use strict";function t(n){var t=this;return new t(function(t,e){e(n)})}n.reject=t}),n("promise/resolve",["exports"],function(n){"use strict";function t(n){if(n&&"object"==typeof n&&n.constructor===this)return n;var t=this;return new t(function(t){t(n)})}n.resolve=t}),n("promise/utils",["exports"],function(n){"use strict";function t(n){return e(n)||"object"==typeof n&&null!==n}function e(n){return"function"==typeof n}function r(n){return"[object Array]"===Object.prototype.toString.call(n)}var i=Date.now||function(){return(new Date).getTime()};n.objectOrFunction=t,n.isFunction=e,n.isArray=r,n.now=i}),t("promise/polyfill").polyfill()}()}),require.register("eventric/src/helper/underscore",function(n,t,e){(function(){var t=this,r=t._,i={},o=Array.prototype,s=Object.prototype,u=Function.prototype,a=o.push,c=o.slice,l=(o.concat,s.toString),f=s.hasOwnProperty,p=Array.isArray,h=Object.keys,g=(u.bind,function(n){return n instanceof g?n:this instanceof g?void(this._wrapped=n):new g(n)});"undefined"!=typeof n?("undefined"!=typeof e&&e.exports&&(n=e.exports=g),n._=g):t._=g,g.VERSION="1.6.0",g.each=g.forEach=function(n,t,e){if(null==n)return n;if(n.length===+n.length){for(var r=0,o=n.length;o>r;r++)if(t.call(e,n[r],r,n)===i)return}else for(var s=g.keys(n),r=0,o=s.length;o>r;r++)if(t.call(e,n[s[r]],s[r],n)===i)return;return n},g.keys=function(n){if(!g.isObject(n))return[];if(h)return h(n);var t=[];for(var e in n)g.has(n,e)&&t.push(e);return t},g.invert=function(n){for(var t={},e=g.keys(n),r=0,i=e.length;i>r;r++)t[n[e[r]]]=e[r];return t},g.functions=g.methods=function(n){var t=[];for(var e in n)g.isFunction(n[e])&&t.push(e);return t.sort()},g.extend=function(n){return g.isObject(n)?(g.each(c.call(arguments,1),function(t){for(var e in t)n[e]=t[e]}),n):n},g.defaults=function(n){return g.isObject(n)?(g.each(c.call(arguments,1),function(t){for(var e in t)void 0===n[e]&&(n[e]=t[e])}),n):n},g.isEqual=function(n,t){return eq(n,t,[],[])},g.isEmpty=function(n){if(null==n)return!0;if(g.isArray(n)||g.isString(n)||g.isArguments(n))return 0===n.length;for(var t in n)if(g.has(n,t))return!1;return!0},g.isElement=function(n){return!(!n||1!==n.nodeType)},g.isArray=p||function(n){return"[object Array]"==l.call(n)},g.isObject=function(n){return n===Object(n)},g.each(["Arguments","Function","String","Number","Date","RegExp"],function(n){g["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),g.isArguments(arguments)||(g.isArguments=function(n){return g.has(n,"callee")}),"function"!=typeof/./&&(g.isFunction=function(n){return"function"==typeof n}),g.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},g.isNaN=function(n){return g.isNumber(n)&&n!=+n},g.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},g.isNull=function(n){return null===n},g.isUndefined=function(n){return void 0===n},g.has=function(n,t){return null!=n&&f.call(n,t)},g.noConflict=function(){return t._=r,this},g.identity=function(n){return n},g.constant=function(n){return function(){return n}},g.noop=function(){},g.property=function(n){return function(t){return t[n]}},g.matches=function(n){return function(t){if(null==t)return g.isEmpty(n);if(t===n)return!0;for(var e in n)if(n[e]!==t[e])return!1;return!0}},g.times=function(n,t,e){for(var r=Array(Math.max(0,n)),i=0;n>i;i++)r[i]=t.call(e,i);return r},g.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},g.now=Date.now||function(){return(new Date).getTime()};var m={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};m.unescape=g.invert(m.escape);var d={escape:new RegExp("["+g.keys(m.escape).join("")+"]","g"),unescape:new RegExp("("+g.keys(m.unescape).join("|")+")","g")};g.each(["escape","unescape"],function(n){g[n]=function(t){return null==t?"":(""+t).replace(d[n],function(t){return m[n][t]})}}),g.result=function(n,t){if(null==n)return void 0;var e=n[t];return g.isFunction(e)?n[t]():e},g.mixin=function(n){g.each(g.functions(n),function(t){var e=g[t]=n[t];g.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),y.call(this,e.apply(g,n))}})};var v=0;g.uniqueId=function(n){var t=++v+"";return n?n+t:t},g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};g.chain=function(n){return g(n).chain()};var y=function(n){return this._chain?g(n).chain():n};g.mixin(g),g.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=o[n];g.prototype[n]=function(){var e=this._wrapped;return t.apply(e,arguments),"shift"!=n&&"splice"!=n||0!==e.length||delete e[0],y.call(this,e)}}),g.each(["concat","join","slice"],function(n){var t=o[n];g.prototype[n]=function(){return y.call(this,t.apply(this._wrapped,arguments))}}),g.extend(g.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)});