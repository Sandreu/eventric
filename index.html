<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>eventric.js by efacilitation</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <img src="images/eventric.png" border="none">
        <h1 class="header">eventric.js</h1>
        <p class="header">Build web applications based on Domain-driven Design</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/efacilitation/eventric/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/efacilitation/eventric/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/efacilitation/eventric">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/efacilitation">efacilitation</a></p>


      </header>
      <section>
        <blockquote>
<p>Not released yet. This hint will disappear with version 0.1.0.</p>
</blockquote>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<p><strong>DDD BuildingBlocks</strong></p>

<ul>
<li>BoundedContext</li>
<li>DomainEvent</li>
<li>Aggregate</li>
</ul><p><strong>CQRS</strong></p>

<ul>
<li>Persistent ReadModels and ProcessManagers</li>
<li>Support for Occasionally Connected Applications</li>
</ul><p><strong>EventSourcing</strong></p>

<ul>
<li>Automated saving and applying of DomainEvents</li>
<li>Multiple Store Adapters</li>
</ul><h2>
<a name="philosophy" class="anchor" href="#philosophy"><span class="octicon octicon-link"></span></a>Philosophy</h2>

<ul>
<li>Emphasize <a href="https://www.goodreads.com/book/show/179133.Domain_Driven_Design">Domain-driven design</a>, <a href="https://www.goodreads.com/book/show/12369902-event-centric">Event-driven architecture</a> and <a href="http://cqrs.wordpress.com/documents/task-based-ui">Task-based UIs</a>.</li>
<li>Put the the Domain Model in the very center of your Layered Architecture (<a href="http://jeffreypalermo.com/blog/the-onion-architecture-part-1/">Onion</a> / <a href="http://alistair.cockburn.us/Hexagonal+architecture">Hexagonal</a>)</li>
<li>Explicitly set boundaries for parts of your application (<a href="https://en.wikipedia.org/wiki/Domain-driven_design#Bounded_context">BoundedContexts</a> / <a href="http://martinfowler.com/articles/microservices.html">MicroServices</a>)</li>
<li>Separation of concerns using Commands and Queries (<a href="http://msdn.microsoft.com/en-us/library/jj554200.aspx">CQRS</a>)</li>
<li>Capture all changes to your application state as a sequence of events (<a href="http://martinfowler.com/eaaDev/EventSourcing.html">EventSourcing</a> / <a href="http://www.udidahan.com/2009/06/14/domain-events-salvation/">DomainEvents</a>)</li>
</ul><h2>
<a name="a-note-on-ddd" class="anchor" href="#a-note-on-ddd"><span class="octicon octicon-link"></span></a>A Note on DDD</h2>

<p>Please keep in mind that eventric.js supplies you only with a structure that has common-sense in the DDD+CQRS community. But you really should get to know the tactical side of DDD as well, which is at least as important (and fun!) as the technical BuildingBlocks. When you dive into the topic you will quickly learn that the BoundedContext is mostly refered to as a tactical pattern. We decided to make it a technical pattern too because we think that it will help grasp the concept.</p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting started</h2>

<p>For this example we use <code>MongoDB</code>. So a prerequisite is to install it locally. If its up and running we need the <code>eventric</code> and <code>eventric-store-mongodb</code> npm packages.</p>

<pre><code>npm install eventric
npm install eventric-store-mongodb
</code></pre>

<p>Initialize the Store and configure eventric to use it.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">eventric</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'eventric'</span><span class="p">);</span>

<span class="nx">eventricMongoDbStore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'eventric-store-mongodb'</span><span class="p">);</span>
<span class="nx">eventricMongoDbStore</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">eventric</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'store'</span><span class="p">,</span> <span class="nx">eventricMongoDbStore</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h3>
<a name="setup-boundedcontext" class="anchor" href="#setup-boundedcontext"><span class="octicon octicon-link"></span></a><a href="https://github.com/efacilitation/eventric/wiki/eventric#eventricboundedcontext">Setup BoundedContext</a>
</h3>

<p>Having discussed the upcoming <strong>TodoApp Project</strong> with the Business-Experts and fellow Developers it got clear that we should start with a <code>BoundedContext</code> named <code>Collaboration</code>.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">collaboration</span> <span class="o">=</span> <span class="nx">eventric</span><span class="p">.</span><span class="nx">boundedContext</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s1">'collaboration'</span><span class="p">})</span>
</pre></div>

<h3>
<a name="define-the-event" class="anchor" href="#define-the-event"><span class="octicon octicon-link"></span></a><a href="">Define the Event</a>
</h3>

<p>Inside of our <code>Collaboration</code> Context things will happen which are called DomainEvents. A technique to come up with these is called <a href="http://ziobrando.blogspot.co.uk/2013/11/introducing-event-storming.html">EventStorming</a>. Lets add one called <code>TodoDescriptionChanged</code>.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">collaboration</span><span class="p">.</span><span class="nx">addDomainEvent</span><span class="p">(</span><span class="s1">'TodoDescriptionChanged'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">description</span><span class="p">;</span>
<span class="p">})</span>
</pre></div>

<h3>
<a name="adding-an-aggregate" class="anchor" href="#adding-an-aggregate"><span class="octicon octicon-link"></span></a><a href="https://github.com/efacilitation/eventric/wiki/BoundedContext#addaggregate">Adding an Aggregate</a>
</h3>

<p>Now we need an Aggregate which actually raises this DomainEvent and is able to handle it. Lets add it.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">collaboration</span><span class="p">.</span><span class="nx">addAggregate</span><span class="p">(</span><span class="s1">'Todo'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">changeDescription</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">description</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$raiseDomainEvent</span><span class="p">(</span><span class="s1">'TodoDescriptionChanged'</span><span class="p">,</span> <span class="p">{</span><span class="nx">description</span><span class="o">:</span> <span class="nx">description</span><span class="p">})</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">handleTodoDescriptionChanged</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">domainEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="nx">domainEvent</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">description</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>

</pre></div>

<blockquote>
<p>Hint: <code>this.$raiseDomainEvent</code> is dependency injected and the handle method is called by naming convention after raising.</p>
</blockquote>

<h3>
<a name="adding-commandhandlers" class="anchor" href="#adding-commandhandlers"><span class="octicon octicon-link"></span></a><a href="https://github.com/efacilitation/eventric/wiki/BoundedContext#addcommand">Adding CommandHandlers</a>
</h3>

<p>To actually work with the <code>BoundedContext</code> from the outside world we need <code>CommandHandlers</code>. Let's start by adding a simple one that will create an instance of our <code>Todo</code> Aggregate.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">collaboration</span><span class="p">.</span><span class="nx">addCommandHandler</span><span class="p">(</span><span class="s1">'createTodo'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$aggregate</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">'Todo'</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">aggregateId</span><span class="p">){</span>
    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">aggregateId</span><span class="p">);</span>
  <span class="p">})</span>
<span class="p">});</span>
</pre></div>

<blockquote>
<p>Hint: <code>this.$aggregate</code> is dependency injected</p>
</blockquote>

<p>It would be nice if we could change the description of the <code>Todo</code>, so let's add this <code>CommandHandler</code> too.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">collaboration</span><span class="p">.</span><span class="nx">addCommandHandler</span><span class="p">(</span><span class="s1">'changeTodoDescription'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$aggregate</span><span class="p">.</span><span class="nx">command</span><span class="p">({</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">'Todo'</span><span class="p">,</span>
    <span class="nx">id</span><span class="o">:</span> <span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="nx">methodName</span><span class="o">:</span> <span class="s1">'changeDescription'</span><span class="p">,</span>
    <span class="nx">methodParams</span><span class="o">:</span> <span class="p">[</span><span class="nx">params</span><span class="p">.</span><span class="nx">description</span><span class="p">]</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<h3>
<a name="adding-a-domaineventhandler" class="anchor" href="#adding-a-domaineventhandler"><span class="octicon octicon-link"></span></a><a href="https://github.com/efacilitation/eventric/wiki/BoundedContext#adddomaineventhandler">Adding a DomainEventHandler</a>
</h3>

<p>And last but not least we want to console.log when the description of the <code>Todo</code> changes.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">collaboration</span><span class="p">.</span><span class="nx">addDomainEventHandler</span><span class="p">(</span><span class="s1">'TodoDescriptionChanged'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">domainEvent</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">domainEvent</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">description</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h3>
<a name="executing-commands" class="anchor" href="#executing-commands"><span class="octicon octicon-link"></span></a>Executing <a href="https://github.com/efacilitation/eventric/wiki/BoundedContext#command">Commands</a>
</h3>

<p>Initialize the Context, create a <code>Todo</code> and tell the <code>Todo</code> to change its description.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">todoId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="nx">collaboration</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="nx">collaboration</span><span class="p">.</span><span class="nx">command</span><span class="p">({</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">'createTodo'</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">todoId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">collaboration</span><span class="p">.</span><span class="nx">command</span><span class="p">({</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">'changeTodoDescription'</span><span class="p">,</span>
      <span class="nx">params</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">todoId</span><span class="p">,</span>
        <span class="nx">description</span><span class="o">:</span> <span class="s1">'Do something'</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">});</span>

<span class="p">});</span>
</pre></div>

<p>After executing the Commands the DomainEventHandler will print <code>Do something</code>. Your <code>Todo</code> Aggregate is now persisted using EventSourcing.</p>

<p>Congratulations, you have successfully applied DDD and CQRS! :)</p>

<h2>
<a name="running-tests" class="anchor" href="#running-tests"><span class="octicon octicon-link"></span></a>Running Tests</h2>

<p>To execute all (client+server) tests, use:</p>

<pre lang="shell"><code>gulp spec
</code></pre>

<p>You can watch for file-changes with</p>

<pre lang="shell"><code>NODE_ENV=workstation gulp watch
</code></pre>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>MIT</p>

<p>Copyright (c) 2013-2014 SixSteps Team, eFa GmbH</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
